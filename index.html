<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="aKer">
<meta property="og:url" content="https://shaohung001.github.io/index.html">
<meta property="og:site_name" content="aKer">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="aKer">





  
  
  <link rel="canonical" href="https://shaohung001.github.io/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>aKer</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">aKer</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2019/09/13/2019-6-10lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/09/13/2019-6-10lesson/" class="post-title-link" itemprop="url">2019-6-10lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-09-13 23:26:02 / Modified: 23:27:41" itemprop="dateCreated datePublished" datetime="2019-09-13T23:26:02+00:00">2019-09-13</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="docker-mongo-dump-restore"><a href="#docker-mongo-dump-restore" class="headerlink" title="docker mongo dump restore"></a>docker mongo dump restore</h1><h2 id="Dump"><a href="#Dump" class="headerlink" title="Dump"></a>Dump</h2><pre><code>docker run --name newMongo -p 27018:27017 --rm mongo
</code></pre><p>另开一个terminal</p>
<pre><code>docker exec -it newMongo /bin/bash

mongodump -h 127.0.0.1 --port 27017 -d ${your db} -o /test/mongodBack

exit # 退出docker mongo容器

docker cp newMongo:/test/mongodBack/ /mongodBack/ # 将docker 内文件拷到/mongodBack/
</code></pre><h2 id="Restore"><a href="#Restore" class="headerlink" title="Restore"></a>Restore</h2><p>待撸待撸</p>
<p>参考：<a href="https://www.cnblogs.com/qiyc/p/10150433.html" target="_blank" rel="noopener">https://www.cnblogs.com/qiyc/p/10150433.html</a></p>
<h1 id="OAuth2-server-撸saas-微应用化"><a href="#OAuth2-server-撸saas-微应用化" class="headerlink" title="OAuth2-server 撸saas 微应用化"></a>OAuth2-server 撸saas 微应用化</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Client frontend] GET /auth/honglian to [Client backend]</span><br><span class="line">[Client backdnd] redirectTo [Server frontend] page : /oauth/authorize?clientId=x&amp;redirectUri=x&amp;response_code=code</span><br><span class="line">[Server frontend] POST /oauth/login/authorise to [Server backend] to fetch oauth authorization_code</span><br><span class="line">[Server frontend] redirectTo(window.location) redirectUri + code=$&#123;authorization_code&#125;</span><br><span class="line">[Client backend] get authorization_code</span><br><span class="line">[Client backend] POST /oauth/access_token/?client_id=x -H &apos;authorization=$&#123;authorization_code&#125;&apos; to [Server backend] to fetch access_token</span><br><span class="line">[Server backend] return access_token to [Client backend]</span><br><span class="line">[Client backend] GET /api/user/?client_id=x&amp;client_secret=x&amp;access_token to [Server backend]</span><br><span class="line">[Server backend] return userProfile to [Client backend]</span><br><span class="line">[Client backend] redirectTo [/user/home]</span><br></pre></td></tr></table></figure>
<p>beyond over!</p>
<p>参考：</p>
<ol>
<li><p><a href="https://gist.github.com/tabone/d74fb922669e4edc22bfd0833b5ae88b" target="_blank" rel="noopener">https://gist.github.com/tabone/d74fb922669e4edc22bfd0833b5ae88b</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/vipzhou/p/8125924.html" target="_blank" rel="noopener">https://www.cnblogs.com/vipzhou/p/8125924.html</a></p>
</li>
</ol>
<h1 id="记一次上线应用遇到的问题"><a href="#记一次上线应用遇到的问题" class="headerlink" title="记一次上线应用遇到的问题"></a>记一次上线应用遇到的问题</h1><p>做更新服务器代码优化，上线的一次经历</p>
<p>表现：使用multy 解析data 文件，文件下来了，但是服务器总是没拿到。</p>
<p>前几个版本都是完全没问题的。我线下测试环境完全没问题，这个是最奇葩的。</p>
<p>然后伟哥在k8s那里切换可运行的包；我对比对比之前版本代码，没发现头绪，就想着去docker 容器内部搞搞。然后一直没头绪，然后脑残了一把：rm -rf  packages/</p>
<p>本来我是想packages/uploads/下的，因为packages 目录不熟悉，我跑到packages/ 这里来运行sh.</p>
<p>运行完那一瞬间，你懂的，我突然又反应过来，我的天，之前填的测试数据全部没了。我擦咧。</p>
<p>突然脑残的可以。</p>
<p>更脑残的是，之前更新服务一直报上传上去的文件找不到，删了之后又可以。你说，这是不是让人更摸不到点了。</p>
<p>然后伟哥找到两个版本不同差异，一个能使用，一个不行。然后就看了里面的代码不同点。</p>
<p>最后发现我在拆分一个方法成为3个中间件时，第一个中间件取值有误，没发现。</p>
<p>也就是我的代码是有问题的(js 就是这毛病)。但是我先下服务器是正常的、删了测试服务器/packages 下也正常了。</p>
<p>郁结，郁结。</p>
<h1 id="www-form-urlencoded-d-里面的-被替换成-nbsp-的问题"><a href="#www-form-urlencoded-d-里面的-被替换成-nbsp-的问题" class="headerlink" title="www-form-urlencoded -d 里面的+ 被替换成**&nbsp;的问题"></a>www-form-urlencoded -d 里面的<strong>+</strong> 被替换成<em>**&nbsp;</em>的问题</h1><p>场景是用户发送一个<code>www-form-urlencoded</code> 内容是一个机器码，比如<code>MH20ew2r9RuTyGcX+rrmxF7X40U=</code> 但是发现传到服务器时，却变成了<code>MH20ew2r9RuTyGcX rrmxF7X40U=</code>. 中间是空格代替。</p>
<p>原因是空格在urlencoded 中就是”+”。于是参数从软件客户端发到web 时都是正确的。但是到了body-parser 时，body-parser 看到一个<strong>+</strong>，想都不想，直接就转成空格了。、</p>
<p>临时处理办法：将该文本转回去: string.replace(/\s/g, ‘+’)</p>
<p>最终解决方案：软件客户端使用urlencoded 刷新string</p>
<h1 id="最近做公司功能时总是会出现bug感悟"><a href="#最近做公司功能时总是会出现bug感悟" class="headerlink" title="最近做公司功能时总是会出现bug感悟"></a>最近做公司功能时总是会出现bug感悟</h1><p>由于上周、最近有点忙，冲刺科目三、完成自己服务的基础设施、尚未完全适应公司业务、同时负责好多个端的前后端，等等，写完了功能，没有去好好测试，导致做的产品总是有这个那个小问题。</p>
<p>这次做完后，不急着上传，在可能涉及到的功能区点点试试(还没适应单元测试),于是就这样还发现一些bug。</p>
<p>有些原因是，修改bugs 改动了其他代码，导致波及到其他功能区，引用区。</p>
<p>在没有进行完整的单元测试情况下，多点点还是有必要的，相信自己总是会出错的。</p>
<p>接下来很重要的，就是多完成功能测试，毕竟面向的是客户(我这里还是没有测试人员的)，不然出了问题就小麻烦了，哈哈</p>
<p>提几点代码上的建议：</p>
<ol>
<li><p>命名规范一定一定要统一，是驼峰就一定要保持，是下划线就一定要保持</p>
</li>
<li><p>命名逻辑一定要符合</p>
</li>
</ol>
<h1 id="考科目三"><a href="#考科目三" class="headerlink" title="考科目三"></a>考科目三</h1><p>考科目三前，集中加训了一番。前一天晚上(周五)还练到9点多。第二天是第一场，也就是必须在7：30 之前刷卡签到。</p>
<p>周六一早6点出发，到的时候才6：40，手机放托管柜，用身份证拿了张号牌(号牌one)进入等待室。突然肚子痛，屁颠屁颠去厕所(plz,厕所门关不上的那种老厕所，哈哈).</p>
<p>等了会，开始分配打乱顺序，分到的前往下一个候考室。去了排了好长队。到我时，按了个手印，拿了张号牌(号牌two)，进到一个小房间，哇，里面坐满了人。每人身上披一个淡绿色小马甲，都是挂在凳子上的。</p>
<p>开始考试了。一个大叔进来根据液晶屏分配的号牌two 每次选4个人。我很巧，搞好有同一个教练分配的学生。</p>
<p>一个安全员老大叔等4个人坐满，一溜烟就载我们到了一号线考场。一个女生先考。打指纹、绕车一周、考灯光、都ok。开始走了，一路上看她开的还ok，前方一个公交站牌估计是刹车早了一丢丢，然后电子设备显示正在连接网络。然后大叔就让菇凉靠边。菇凉一脸懵，我就默默记住这个点，似乎会有踩早的状况。然后所有项目重做，然后继续出发。出发后方有车，她一直在右侧开，我觉得她再开下去可能会不合格: 在非考试道路长时间行驶。幸好她看到左侧安全拐过来了。</p>
<p>她继续行驶，有些规则还是不熟，看得出来，不过都ok。然后车子最后一个左拐时，就提示成功了，她吁了口气，不然两次机会就完了。</p>
<p>接下来就是我啦。我在菇凉停车地方上车。一切按教练教的，不慌不忙。打卡，下车走一圈，绕车一周，绕车时，似乎没听到考试机器叫有学员通过。当时风很大，我以后只是没听清，坐上车，系好安全带，然后考试机器就报重考。我擦，我都还没考呢。。。我刚才特意死命戳那个按钮了。好吧，下车再来一次，这次死命戳，发现还是没声音，很纳闷，往车内看，用眼神问学员(就是同教练那个学员)，学员摇了摇头，说明还是没有检测到有学员通过。然后我再用力死命戳，侧耳听，终于听到了有声响了。报了才安心通过。</p>
<p>哇，这是个大坑。之后做完灯光，左侧有车，我就一直等，等到没车了，才慢悠悠出发。一路上小心谨慎，毕竟只有一次机会。起步、公交站台刹车、路口刹车一个都不能错。加减档位、加速5挡、会车、掉头、靠边停车、超车、直线行驶、右转弯、掉头(掉头完立马就有个公交站台, 这时二挡就要踩刹车)，左拐，这时考试机器又报正在连接网络，我擦，我挂了，这声音和之前我挂了是一个样的。过了一会，说通过考试，请靠边停车。我擦，幸福来得太美好。下车之后提醒后面考试学员，右后方那个按钮，贼难按。</p>
<p>幸亏一起考的学员，眼神提示。不然两次全挂在啥都没考，就要滚回去了。我不能不过，没时间花在这里啊。基本科三过了，就等于学车告一段落了。好好赚钱钱咯，，哇卡卡卡。</p>
<h1 id="Chrome-Extension-使用Vue-遇到的一些问题"><a href="#Chrome-Extension-使用Vue-遇到的一些问题" class="headerlink" title="Chrome Extension 使用Vue 遇到的一些问题"></a>Chrome Extension 使用Vue 遇到的一些问题</h1><p>Vue 使用webpack。但是background.js 属于后台，使用nodejs，于是webpack 找require 函数时可能会找不到比如<strong>fs</strong> 的库：Module not found.</p>
<p>做的第一种尝试: 在webpack 打包target 默认为的<code>web</code> 替换为<code>node</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    target: &apos;web&apos;,</span><br><span class="line">    node: &#123;</span><br><span class="line">        console:false,</span><br><span class="line">        global: true,</span><br><span class="line">        process: true,</span><br><span class="line">        fs: true,</span><br><span class="line">        __filename: &apos;mock&apos;,</span><br><span class="line">        ___dirname: &quot;mock&quot;,</span><br><span class="line">        Buffer: true,</span><br><span class="line">        setImmediate: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这样的也导致输出的是node 环境。界面上的css 样式全部都不识别了。<br>于是替换一种思路。</p>
<p>第二种尝试: 前段还是按照前段，后端之所以称之为后端，那么便是另外一个项目了。webpack 打包时，打一个虚拟的，没有任务的background 包。于是<code>yarn watch</code> 阶段background 包打进去之后，手动替换里面background.js。</p>
<p>终于，里面运行的非常正常了。</p>
<p>这种方法不同点是，之前的background 配置是page,现在应为scripts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">background: &#123;</span><br><span class="line">    page: &quot;./background.html&quot;</span><br><span class="line">    scripts: [&quot;./background.js&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="https://cloud.tencent.com/developer/section/1477428" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1477428</a></li>
<li><a href="https://cloud.tencent.com/developer/section/1477500" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1477500</a></li>
</ul>
<h2 id="最近感触良多，工作生活体悟良多"><a href="#最近感触良多，工作生活体悟良多" class="headerlink" title="最近感触良多，工作生活体悟良多"></a>最近感触良多，工作生活体悟良多</h2><p>2019/6/3</p>
<p>公司要更新以前的Chrome 拓展JS编辑器。我体验了从开发、初次打包。然后继续开发完成后，到最后完整build 的流程。</p>
<p>最终使用Gulp 一次构建完毕应用。</p>
<p>这次体验极佳，虽然中间很多次很多次的碰见南墙，但是没有回头路。</p>
<p>本来听老大说要招一个人来做，不过觉得让我试试会更好，我当然义不容辞，好好给他整好来。</p>
<p>当前使用ace 库制作用户输入简易脚本编辑器，完成JavaScript、Iced 输入代码，高亮、切换主题，然后点击运行得出结果。</p>
<p>当前仍然继续维护。。。</p>
<p>这几天似乎临近6.4.好多好多的伟皮恩 被干掉，我们公司三个公用的，全部报废。我手上的唯一一个挂了。然后不服气的我充值再买一个ip，想成为RMB 玩家，然后还是敌不过。两次被封，实属让我心力憔悴。第二次被封情景：我为了查资料，就开了一会，就我一个人用，用资料啊。查知识，学知识如果是犯法，那中国活该一万年都是发展中国家，把柄永远捏在美国手里。</p>
<p>然后今天努力了一天，采用了别人牛逼的思路。让我的服务器死而复生。待我细细道来。</p>
<h2 id="让服务躲在墙后面"><a href="#让服务躲在墙后面" class="headerlink" title="让服务躲在墙后面"></a>让服务躲在墙后面</h2><p>当前有两种方案，大体一致，不过由于关于联合TLS、Nginx、V2ray 等有些知识点可能有欠缺，当前使用他人一键生成。另一种不带TLS、Nginx 的还算方便。</p>
<p>当前处境: 我的ip 已经ping不通了。只能通过CDN 转向我的服务器进行拯救了。</p>
<p>第一种方案: centos 6.x</p>
<p>完全参考了<a href="https://blog.sprov.xyz/2019/03/11/cdn-v2ray-safe-proxy/?nsukey=PEs3kShj8DxdLAd3a9jeRtDkzetIbO3xXnhHySES87Vh3RxI6cD9jnzuo9YEAA99yX1xplHFNfsTv%2FO%2Bz%2Bn9Qn%2BdAUPmbU7H5yiscRg1UFRN6lnyQaMmnsZUNt2UxH3XUkV%2Bn992u4jXNqU0%2FH0ikRVtQPIVQw1NayReOpdThcwptuD4OVpLLeAZwTZ5ljabCV7QqcLytsux%2BYWycaTcqQ%3D%3D" target="_blank" rel="noopener">sprov 的博客</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1. 前往Freecom 申请一个免费域名</span><br><span class="line">2. Freecom ManageDNS 添加`A`记录. eg: www.gogal.ml A 67.230.172.104</span><br><span class="line">3. 前往CloudFlare 申请注册一个免费的CDN</span><br><span class="line">4. CloudFlare **add** 时，填入二级域名. eg:gogal.ml</span><br><span class="line">5. 选择Free 套餐</span><br><span class="line">6. 增加子域，同时指向你的ip eg: fuck.gogal.ml 67.230.172.104</span><br><span class="line"></span><br><span class="line">这时候Status 如果有橙色云朵，代表CDN 已经将你的域名包含进去，此时ping fuck.gogal.ml 出现了CDN 的ip</span><br><span class="line"></span><br><span class="line">7. 下一步会看到让你修改Nameservers(域名服务器)。其在ManageDNS 左边tab栏，填上那两个值，continue</span><br><span class="line">8. 接下来到了CloudFlare CDN 的dashboard。</span><br><span class="line"></span><br><span class="line">顶部有很多栏目，有两个重要栏目：DNS、Crypto</span><br><span class="line"></span><br><span class="line">DNS 是管理你的域名，开关你的CDN 需求。</span><br><span class="line"></span><br><span class="line">Crypto 管理你的TLS 加密与否(默认Full 加密)。这个很重要。</span><br><span class="line"></span><br><span class="line">前往Crypto 将TLS 置为`Off` 或者Flexible</span><br></pre></td></tr></table></figure>
<p>上面关于前提配置完毕。接下来去你的服务器</p>
<p>前往你的服务器ssh(ip 挂了，但是服务器商会提供页面Interactive，使用root 和你的登录密码进行登录)</p>
<p><a href="https://blog.sprov.xyz/2019/02/04/v2ray-simple-use/" target="_blank" rel="noopener">V2ray安装教程</a></p>
<p><code>bash &lt;(curl -L -s https://install.direct/go.sh)</code></p>
<p>这样就安装了V2ray。配置目录在/etc/v2ray/config.json</p>
<p>安装完成后，出现PORT、UUID。这两个记录下来，忘记了就cat /etc/v2ray/config.json 将端口和uuid 打印出来。</p>
<p><code>service v2ray start &amp;&amp; service v2ray status</code> // centos6.x</p>
<p><code>systemctl start v2ray &amp;&amp; systemctl status v2ray</code> // centos7</p>
<p>关闭防火墙：</p>
<p><code>service iptables stop &amp;&amp; chkconfig iptables off</code> // centos6.x 关闭防火墙、关闭开机打开防火墙</p>
<p><code>systemctl stop firewalld &amp;&amp; systemctl disable firewalld</code> // centos7</p>
<p>由于我的服务器就在洛杉矶，bbr 什么什么加速我就没开了。</p>
<p>最后一步就是连接了。</p>
<p>服务器v2ray/config.json 的inbound参考如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    "port": 80, // 很重要，否则CDN 找不进来</span><br><span class="line">    "streamSettings": &#123;</span><br><span class="line">        "wsSettings": &#123;</span><br><span class="line">            "path": "/58ff4ec7/",</span><br><span class="line">            "headers": &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "network": "ws"</span><br><span class="line">    &#125;,</span><br><span class="line">    "settings": &#123;</span><br><span class="line">        "clients": [</span><br><span class="line">            "id": "xxx", // 通过 /usr/bin/v2ray/v2ctl uuid 生成</span><br><span class="line">            "alterId": 64</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Address: fuck.gogal.ml : 443</span><br><span class="line">User ID:  xxx</span><br><span class="line">alterId: 64</span><br><span class="line">Security: chacha20那个</span><br><span class="line">Tag: 随便填，，标签使用而已</span><br><span class="line">NetWork: ws</span><br><span class="line">transport settings:</span><br><span class="line">   WebSocket:</span><br><span class="line">    path: /58ff4ec7/</span><br><span class="line">   TLS:</span><br><span class="line">    Use TLS</span><br><span class="line">    TLS serverName: fuck.gogal.ml</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/Cenmrev/V2RayW/releases" target="_blank" rel="noopener">V2rayW</a></p>
<p><a href="https://github.com/Cenmrev/V2RayX/releases" target="_blank" rel="noopener">V2rayX</a></p>
<h2 id="TLS版本"><a href="#TLS版本" class="headerlink" title="TLS版本"></a>TLS版本</h2><p>环境: centos7</p>
<p><a href="https://github.com/wulabing/V2Ray_ws-tls_bash_onekey" target="_blank" rel="noopener">github 一键脚本</a></p>
<p>首先通过TLS 一键脚本生成，自己整还是挺麻烦。内容包括Nginx 转发配置，OpenSSL 配置TLS证书，V2ray配置ssl。</p>
<p>配置完成后可以在clients 字段里面添加更多id。</p>
<p>完成后，在客户端注意点：</p>
<ol>
<li>transport settings - WebSocket栏目 - path 填写对应路径</li>
<li>TLS 打勾，同时填写你的CDN 转换的域名</li>
<li>Network 选ws</li>
<li>CloudFlare CDN 的Crypto 置为full。</li>
</ol>
<p>此时基本很健康，不容易再被打掉(毕竟我ip已经被打掉了)。</p>
<p>这里提一点，不晓得为什么有些电脑就是连不上我的服务器，有些一填就好了，很奇怪。</p>
<h2 id="服务器不放vps换个免费地方放"><a href="#服务器不放vps换个免费地方放" class="headerlink" title="服务器不放vps换个免费地方放"></a>服务器不放vps换个免费地方放</h2><p>6.1 第一次遇到GFW，很多计划都得往后搁置，不过遇到了就是好事。</p>
<p>我找了AWS，注册送12个月免费服务。扣了我1美金后，看了别的文章说容易一点错就扣费。说申诉还是会退回，不过这就让我觉得不可靠。果断弃坑。找到了我以前使用的heroku, 还是一样的免费，那我用cdn 中转，是不是能解决被限速严重的问题？说干就干，毕竟6.7 高考的人拼命，我也要拼命努力啊。</p>
<p>我使用的是nodejs docker。代码上修改配置文件</p>
<p>package.json<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    scripts: &#123;</span><br><span class="line">        start: 'NODE_ENV=production node app.js'</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>同时app.js 的app.listen port。该port 使用process.env.PORT(heroku 提供了该port)</p>
<p>下载heroku cli<br><code>sudo npm install -g heroku</code></p>
<p>heroku 登录<br><code>heroku login</code></p>
<p>heroku container 登录<br><code>heroku container login</code></p>
<p>heroku container push<br><code>heroku container:push web --app ahuang-diary</code> (ahuang-diary 是我的项目名)</p>
<p>heroku container release 发布<br><code>heroku container:release web --app ahuang-diary</code></p>
<p>代码发布后，可以翻墙测试下是否通畅.</p>
<p>可以使用右上角功能键: <strong>Open APP</strong> <strong>More</strong></p>
<p>More 下面有view logs。这个估计是比较有用的。</p>
<p>此时采用CDN 转发稍微加速heroku(感觉速度还是不怎么快，同时使用free 免费heroku，升级hobby 花钱才能使用https)。</p>
<p>使用自定义域名，需要先账号填写信用卡。</p>
<p>dashboard.heroku.com/apps/ahuang-diary 面板下Settings - Domains and certificates 增加<a href="http://diary.boqi.ml" target="_blank" rel="noopener">http://diary.boqi.ml</a></p>
<p>下方会生成DNS Target</p>
<p>DNS Target 放到CloudFlare 的CNAME 值里面，key 就是diary.boqi.ml 橙云点亮，同时Crypto 置为<strong>OFF</strong></p>
<p>这样就成功完成了今天要做的事情了</p>
<h2 id="Typescript-mocha-chai-单元测试"><a href="#Typescript-mocha-chai-单元测试" class="headerlink" title="Typescript + mocha + chai 单元测试"></a>Typescript + mocha + chai 单元测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yarn add mocha @types/mocha chai @types/chai chai-http @types/chai-http -D</span><br><span class="line"></span><br><span class="line">package.json</span><br><span class="line">    scripts</span><br><span class="line">        test: NODE_ENV=test mocha -t 5000 --require ts-node/register test/**/*.ts</span><br><span class="line"></span><br><span class="line">/test</span><br><span class="line">    diary.spec.ts</span><br></pre></td></tr></table></figure>
<p>diary.spec.ts:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; app &#125; <span class="keyword">from</span> <span class="string">'../src/app'</span></span><br><span class="line"><span class="keyword">import</span> chai, &#123; expect &#125; <span class="keyword">from</span> <span class="string">'chai'</span></span><br><span class="line"><span class="keyword">import</span> chaiHttp <span class="keyword">from</span> <span class="string">'chai-http'</span></span><br><span class="line">chai.use(chaiHttp)</span><br><span class="line"><span class="keyword">import</span> <span class="string">'mocha'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userLoginCookie = <span class="string">'123456'</span> <span class="comment">// 由于使用OAuth 服务，那块代码就没有测，直接使用Cookie</span></span><br><span class="line">describe(<span class="string">'测试diary 接口'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'等待数据库载入完毕'</span>)</span><br><span class="line">            done()</span><br><span class="line">        &#125;, <span class="number">1000</span>) <span class="comment">// 时间可以加长，这里链接了mlab ，比较慢，可以为4000(有时仍然会出错)</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'Test getBudgetList'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">        chai.request(app)</span><br><span class="line">            .post(<span class="string">'/api/diary/getBudgetList'</span>)</span><br><span class="line">            .set(<span class="string">'Cookie'</span>, userLoginCookie)</span><br><span class="line">            .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.status === <span class="number">403</span>) &#123;</span><br><span class="line">                    done(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'403 用户需要先登录'</span>))</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> arr = res.body <span class="keyword">as</span> <span class="built_in">any</span>[]</span><br><span class="line">                    expect(arr.length).to.equal(<span class="number">0</span>)</span><br><span class="line">                    done()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="js-ts-如何享受async-舒适下远离try-catchP"><a href="#js-ts-如何享受async-舒适下远离try-catchP" class="headerlink" title="js/ts 如何享受async 舒适下远离try{}catchP{}"></a>js/ts 如何享受async 舒适下远离try{}catchP{}</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> login () &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> userLogin()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.$message.error(e)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>async 带来了很大的方便，但是try/catch 却破坏了写作的美感。</p>
<p>我们想要这样的:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> callAsync, &#123; call &#125; = <span class="built_in">require</span>(<span class="string">'awaitCall'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> login () &#123;</span><br><span class="line">  <span class="comment">// callAsync allows promise as input</span></span><br><span class="line">  <span class="keyword">const</span> [err, response] = <span class="keyword">await</span> callAsync(userLogin())</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="keyword">this</span>.$message.eror(err)</span><br><span class="line">  <span class="comment">// user login successfully</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> writeFile (input) &#123;</span><br><span class="line">  <span class="comment">// call allows any function which can be accepted by require('util').promisify with a promise output</span></span><br><span class="line">  <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> call(fs.write, input)</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="comment">// fs.write successfully</span></span><br><span class="line">  <span class="keyword">const</span> [openErr, openRes] = <span class="keyword">await</span> call(fs.open, <span class="string">'a.txt'</span>, <span class="string">'r+'</span>, <span class="number">0o654</span>)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上提供了两个方法callAsync、call。</p>
<p>callAsync 允许输入promise 之后flattern 回调。</p>
<p>call 支持输入function，帮助用户转化为promise 之后flattern 回调(function 必须支持<code>require(&#39;util&#39;).promisify</code> 转化为promise 类型)。</p>
<p>核心代码不多，支持JS、Typescript</p>
<p>awaitCall.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">callAsync</span>(<span class="params">promise</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> promise</span><br><span class="line">    .then(<span class="function">(<span class="params">data</span>) =&gt;</span> [<span class="literal">null</span>, data])</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> [err, <span class="literal">null</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params">func, ...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> promise = util.promisify(func).call(<span class="keyword">this</span>, ...args)</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> promise !== <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">'func should match util.promisify'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> callAsync(promise)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> callAsync</span><br></pre></td></tr></table></figure>
<p>awaitCall.d.ts</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="built_in">module</span> callAsync &#123;</span><br><span class="line">  export function callAsync&lt;T, U = any&gt;(promise: Promise&lt;T&gt;): Promise&lt;[U | null, T | null]&gt;</span><br><span class="line">  <span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params">func: Function, ...args: any[]</span>): <span class="title">Promise</span>&lt;<span class="title">any</span>&gt;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Typescript 完整实现</p>
<p>awaitCall.ts</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> util <span class="keyword">from</span> <span class="string">'util'</span></span><br><span class="line"></span><br><span class="line">export function callAsync&lt;T, U = any&gt;(promise: Promise&lt;T&gt;): Promise&lt;[U | null, T | null]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> promise</span><br><span class="line">      .then&lt;[<span class="literal">null</span>, T]&gt;<span class="function">(<span class="params">(data: T</span>) =&gt;</span> [<span class="literal">null</span>, data])</span><br><span class="line">      .catch&lt;[U, <span class="literal">null</span>]&gt;(<span class="function"><span class="params">err</span> =&gt;</span> [err, <span class="literal">null</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params">func: Function, ...args: any[]</span>): <span class="title">Promise</span>&lt;<span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> promise = util.promisify(func).call(<span class="keyword">this</span>, ...args)</span><br><span class="line">  <span class="comment">// promise is object type</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> promise !== <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">'func should match util.promisify'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> _promise = promise <span class="keyword">as</span> <span class="built_in">Promise</span>&lt;any&gt;</span><br><span class="line">  <span class="keyword">return</span> callAsync(_promise)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> callAsync</span><br></pre></td></tr></table></figure>
<blockquote>
<p>符合util.promisify 方法特征 \<br>\<br>1 输入的方法参数最后一个<code>typeof === &#39;function&#39;</code> \<br>2 最后一个参数返回的第一个参数，总是err</p>
</blockquote>
<blockquote>
<p>注意this 指针丢失需要开发主动避免哦 \<br>\<br>可以使用 bind(this) 将指针重新找回 \<br>const bindCall = call.bind(that) \<br>await bindCall(fs.write, input) \<br>await bindCall(fs.open, ‘a.txt’, ‘r+’, 0o654)</p>
</blockquote>
<p>参考：</p>
<p><a href="https://github.com/scopsy/await-to-js" target="_blank" rel="noopener">await-to-js</a></p>
<h2 id="V2ray无法联网"><a href="#V2ray无法联网" class="headerlink" title="V2ray无法联网"></a>V2ray无法联网</h2><p>特征: 对比他人config 完全一致后仍然无法联网, 该服务器提供的其他例子能正常使用</p>
<p>查询了很多问题，终于将问题聚焦在了端口被占用上。</p>
<p>同时查到这个V2rayX 的issue107</p>
<blockquote>
<p><a href="https://github.com/Cenmrev/V2RayX/issues/107" target="_blank" rel="noopener">https://github.com/Cenmrev/V2RayX/issues/107</a></p>
</blockquote>
<p><img src="./v2rayx_issue107.png" alt="V2rayX_issue107"></p>
<p>表现完全一致。</p>
<p>操作如下:</p>
<p><img src="v2ray_toNormalStep.jpg" alt="V2ray复活操作"></p>
<p>反正接下来也不适用shadowsocks了，于是我就删了在 /Users/<strong><strong>/Library/LaunchAgents 下为shadowsock</strong></strong>.<em>**</em>.plist 的文件。重启一下电脑，于是就完全表现正常了。</p>
<h2 id="fs-read-readFile-在读取中文时乱码"><a href="#fs-read-readFile-在读取中文时乱码" class="headerlink" title="fs.read/readFile 在读取中文时乱码"></a>fs.read/readFile 在读取中文时乱码</h2><p>需求：文件使用Buffer 读出, 然后一个一个解析里面的中英文<br>环境：文件很大, 所以没办法直接读出、直接写出</p>
<p>英文占一个字节，中文三个字节，所以一个个读出的buffer， 中文时便出现该字找不到，所以nodejs 使用<buffer ef df db> 进行替换。</buffer></p>
<p>nodejs 那些常见的读写库其实都导入了<code>string_decoder</code> 的库</p>
<p>使用是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; StringDecoder &#125; <span class="keyword">from</span> <span class="string">'string_decoder'</span></span><br><span class="line"><span class="keyword">const</span> decoder = <span class="keyword">new</span> StringDecoder(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> next = decoder.write(readBuffer)</span><br><span class="line">  <span class="keyword">if</span> (next.length) &#123;</span><br><span class="line">    <span class="comment">// 这就是得到的buffer</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>decoder 原理是解析出来的，如果是中文三字节找不到，那么就储存起来，等到合并成一个。</p>
<p>附上 oneByOne 读写每个文本</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; StringDecoder &#125; <span class="keyword">from</span> <span class="string">"string_decoder"</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">'fs'</span></span><br><span class="line"><span class="keyword">import</span> &#123; call &#125; <span class="keyword">from</span> <span class="string">'./awaitCall'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> one_openFile = <span class="keyword">async</span> (absolutePath: <span class="built_in">string</span>, mode=<span class="string">'r'</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [e, fd] = <span class="keyword">await</span> call(fs.open ,absolutePath, mode, <span class="number">0o666</span>)</span><br><span class="line">  <span class="keyword">if</span> (e) <span class="keyword">throw</span> e</span><br><span class="line">  <span class="keyword">return</span> fd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> one_readFile = <span class="keyword">async</span> (fd: <span class="built_in">number</span>, offset=<span class="number">0</span>, cb?: <span class="built_in">Function</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> oneByOneSize = <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> len = oneByOneSize</span><br><span class="line">  <span class="keyword">let</span> readIndex = <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> decoder = <span class="keyword">new</span> StringDecoder(<span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> readBuffer = Buffer.alloc(oneByOneSize)</span><br><span class="line">    <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> call(fs.read, fd, readBuffer, offset, len, readIndex)</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">    <span class="keyword">if</span> (!res.bytesRead) &#123;</span><br><span class="line">      <span class="comment">// 文件读完了</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"文件读写完毕"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> next = decoder.write(readBuffer)</span><br><span class="line">    <span class="keyword">if</span> (next.length) &#123;</span><br><span class="line">      <span class="keyword">if</span> (cb)</span><br><span class="line">        cb(next)</span><br><span class="line">    &#125;</span><br><span class="line">    readIndex ++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Run-Mocha-programmatically"><a href="#Run-Mocha-programmatically" class="headerlink" title="Run Mocha programmatically"></a>Run Mocha programmatically</h2><p>在代码中执行mocha。在实际环境中进行单元测试。</p>
<p><a href="https://github.com/mochajs/mocha/wiki/Using-mocha-programmatically" target="_blank" rel="noopener">mocha 官网示例</a></p>
<p><a href="https://stackoverflow.com/questions/29050720/run-mocha-programmatically-and-pass-results-to-variable-or-function" target="_blank" rel="noopener">stackoverflow</a></p>
<h2 id="解决qiniu-上传文件-gt-1G-code-413"><a href="#解决qiniu-上传文件-gt-1G-code-413" class="headerlink" title="解决qiniu 上传文件&gt;1G code=413"></a>解决qiniu 上传文件&gt;1G code=413</h2><p>qiniu v=6.0.9</p>
<p>根据<a href="https://github.com/qiniu/nodejs-sdk/issues/173" target="_blank" rel="noopener">github issue</a>提到，fixed in v7.0.2</p>
<p>更新之后，接口也相应更新，然后同时需要在<code>new qiniu.rs.PutPolicy(options)</code> 的options 设置fsizeLimit,</p>
<p><code>options = { scope: ${bucket}:key, fsizeLimit: 10*1024*1024*1024 }</code> 这样便成功解决上传文件限制大小的问题。</p>
<h2 id="express-limiter"><a href="#express-limiter" class="headerlink" title="express-limiter"></a>express-limiter</h2><p>遇到情况：有一个注册、即立即登录，快速注册快速登录的接口，这里express-limiter 可以多次请求</p>
<p>去redis 上看了下，key 每次都不同</p>
<p>去express-limiter 里看了下, 他的redis key 来自line17: var key = opts.keyFormatter(opts.lookup(req))</p>
<p>找到原因：我去找了下我的lookup</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">loopup = <span class="function">(<span class="params">req:Request</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> ref</span><br><span class="line">  <span class="keyword">if</span> (req.user) &#123;</span><br><span class="line">    ref = req.user._id</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [req.path, ref || req.get(<span class="string">"X-Real-IP"</span>) || req.get(<span class="string">"X-Forward-For"</span>) || req.ip]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原因就在于每次我登进去，key 都不同，与此同时，我不退出，继续使用该api，key 还是不同。</p>
<p>解决方案：由于该route 是public 的，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lookup = <span class="function">(<span class="params">req:Request</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">`<span class="subst">$&#123;req.method&#125;</span>:<span class="subst">$&#123;req.path&#125;</span>`</span></span><br><span class="line">  <span class="keyword">if</span> (routesMap[key].accessLevel.level === <span class="string">'public'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [req.path, req.get(<span class="string">"X-Real-IP"</span>) || req.get(<span class="string">'X-Forwarded-For'</span>) || req.ip]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> ref</span><br><span class="line">  <span class="keyword">if</span> (req.user) &#123;</span><br><span class="line">    ref= req.user._id</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [req.path, ref || req.get(<span class="string">"X-Real-IP"</span>) || req.get(<span class="string">'X-Forwarded-For'</span>) || req.ip]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2019/05/10/2019-5-10lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/10/2019-5-10lesson/" class="post-title-link" itemprop="url">2019-5-10lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-05-10 08:02:51 / Modified: 00:07:46" itemprop="dateCreated datePublished" datetime="2019-05-10T08:02:51+00:00">2019-05-10</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="passport实现oauth2登录【个人中心】流程"><a href="#passport实现oauth2登录【个人中心】流程" class="headerlink" title="passport实现oauth2登录【个人中心】流程"></a>passport实现oauth2登录【个人中心】流程</h3><ol>
<li>首先服务器增加入口路由 /auth/${project} 权限为public。这样前段可通过<code>curl -X GET host/auth/${project}</code> 进入到此方法.</li>
</ol>
<p>配置route:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &apos;/auth/$&#123;project&#125;&apos;,</span><br><span class="line">  method: &apos;GET&apos;,</span><br><span class="line">  middleware: [passport.authenticate(&apos;$&#123;project&#125;&apos;)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>App.ts 设置passport</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.use(cookieParser())</span><br><span class="line">app.use(session(&#123;</span><br><span class="line">  ... // set up session</span><br><span class="line">&#125;))</span><br><span class="line">app.use(passport.initialize())</span><br><span class="line">app.use(passport.session())</span><br><span class="line">passport.use(Auth.$&#123;project&#125;Strategy) // 划重点</span><br><span class="line">passport.serializeUser(Auth.serializeUser)</span><br><span class="line">passport.deserializeUser(Auth.deserializeUser)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>前往Auth 增加${project}Strategy 配置和回调</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export default class AuthClass &#123;</span><br><span class="line">  public static $&#123;project&#125;Strategy = new AAStrategy(StrategyOptionsRequest, async (req:Request, accessToken:string, refreshToken:string, profile:any, done:Function) =&gt; &#123;</span><br><span class="line">    req.session.userProfile = profile._json || &#123;&#125;</span><br><span class="line">    done(null, false)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AAStrategy 是要重新配置的class，稍后说明；StrategyOptionsRequest 为需要输入的options。配置请查看Oauth2Strategy.StrategyOptionsWithRequest。</p>
<ol start="4">
<li>AAStrategy 制作</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export default class AAStrategy extends Oauth2Strategy &#123;</span><br><span class="line">  private _userProfileURL:string</span><br><span class="line">  constructor (options:IStrategyOptions, verify:Oauth2Strategy.VerifyFunctionWithRequest) &#123; // IStrategyOptions extends Oauth2Strategy.StrategyOptionsWithRequest</span><br><span class="line">    super(options, verify)</span><br><span class="line">    this.name = &apos;$&#123;project&#125;&apos;</span><br><span class="line">    this._oauth2.useAuthorizationHeaderforGET(true)</span><br><span class="line"></span><br><span class="line">    let urlParams = `$&#123;checkAspect_id&#125;=$&#123;encodeURIComponent(options.clientID)&#125;&amp;` // checkAspect 为您目标工程的要求；不要忘记最后一个**&amp;**</span><br><span class="line">    this._userProfileURL = `$&#123;config.authUrl&#125;/api/user/?$&#123;urlParams&#125;client_secret=$&#123;encodeURIComponent(options.clientSecret)&#125;&amp;` // 不要忘记**&amp;**</span><br><span class="line">  &#125;</span><br><span class="line">  public userProfile (accessToken:string, done:any) &#123;</span><br><span class="line">    this._userProfileURL = this._userProfileURL + (`access_token=$&#123;encodeURIComponent(accessToken)&#125;`)</span><br><span class="line">    this._oauth2.get(this._userProfileURL, accessToken, function (err:any, body:any, res:any) &#123;</span><br><span class="line">      if (err) &#123;</span><br><span class="line">        return done(new InternalOAuthError(&apos;Failed to fetch user profile&apos;, err))</span><br><span class="line">      &#125;</span><br><span class="line">      done(null, &#123;</span><br><span class="line">        _raw: body,</span><br><span class="line">        _json: json</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>路由重定向回本地认证登录</li>
</ol>
<p>由于我们在填写IStrategyOptions 时，options.callbackURL 填写为<code>${config.authCbURL}/auth/${project}/callback</code></p>
<p>那么我们在路由增加:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &apos;/auth/$&#123;project&#125;/callback&apos;,</span><br><span class="line">  method: &apos;GET&apos;,</span><br><span class="line">  middleware: [passport.authenticate(&apos;$&#123;project&#125;&apos;, &#123;</span><br><span class="line">    failureRedirect: &apos;/auth/login&apos; // 划重点，重定向回来之后会调用/auth/login</span><br><span class="line">  &#125;)]</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  path: &apos;/auth/login&apos;,</span><br><span class="line">  method: &apos;GET&apos;,</span><br><span class="line">  middleware: [Auth.authLogin]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static authLogin (req:Request, res:Response) &#123;</span><br><span class="line">  if (!(req.session.userProfile &amp;&amp; req.session.userProfile.email)) return res.redirect(&apos;/login&apos;)</span><br><span class="line"></span><br><span class="line">  req.session.userProfile = null</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  do something like</span><br><span class="line">  1. UserModel.findOrCreate(userProfile) defer err, user</span><br><span class="line">  2. req.login(user)</span><br><span class="line"></span><br><span class="line">  return res.redirect(&apos;/user/home&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &apos;/profile&apos;,</span><br><span class="line">  method: &apos;GET&apos;,</span><br><span class="line">  middleware: [(req:Request, res:Response) =&gt; &#123;</span><br><span class="line">    res.status(200).send(req.user)</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上服务端方面全部完成。</p>
<p>流程也是比较直观的。</p>
<p>最后的routeRoute 是为了给前端作为判断成功与否的作用。</p>
<h1 id="1-lt-lt-1-1-lt-lt-2-权限位偏移"><a href="#1-lt-lt-1-1-lt-lt-2-权限位偏移" class="headerlink" title="1 &lt;&lt; 1, 1 &lt;&lt; 2 权限位偏移"></a>1 &lt;&lt; 1, 1 &lt;&lt; 2 权限位偏移</h1><p>使用机器计算2进制偏移位来比对用户的权限位。</p>
<p>比如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> &lt;&lt; <span class="number">1</span> === admin,</span><br><span class="line"><span class="number">1</span> &lt;&lt; <span class="number">30</span> === public,</span><br><span class="line"><span class="number">1</span> &lt;&lt; <span class="number">31</span> === anon</span><br></pre></td></tr></table></figure>
<p>结果是，权限卡槽最好至多放32个(计算机可能是为32bit)</p>
<p>判断时，只需在对应权限位进行与或对比即可</p>
<h1 id="微信web登录，内测配置"><a href="#微信web登录，内测配置" class="headerlink" title="微信web登录，内测配置"></a>微信web登录，内测配置</h1><p>公司在审核通过后，微信后台配置域名：<code>ip.gogal.ml:5700</code>这样便可做到本地开发。注意<strong>:5700</strong></p>
<p>同时服务器callbackURL：<code>http://ip.gogal.ml:5700/auth/weixin/callback</code> 这样即可完美跳转callback。</p>
<h1 id="记录下2019-4-26晚上学科目三犯的错"><a href="#记录下2019-4-26晚上学科目三犯的错" class="headerlink" title="记录下2019-4-26晚上学科目三犯的错"></a>记录下2019-4-26晚上学科目三犯的错</h1><p>1 换挡</p>
<pre><code>上5挡时，出现挂错3档位
</code></pre><p>2 抖动</p>
<pre><code>换挡时，出现抖动。要先上档位速度，然后踩离合挂到对应档位，送离合，稳住油门。
</code></pre><p>3 进入待转区、转弯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">转弯、掉头时，到前方一定距离，稳定车速在20多一点点，打转向灯，一定要稳住方向盘3s不动.</span><br><span class="line"></span><br><span class="line">然后在实线前左转进入待转区。速度稳住.在一定距离时，踩离合踩刹车，车头快盖住线时停下。</span><br><span class="line"></span><br><span class="line">1挡出发(转弯上2挡), 有“打半圈”、“打一圈少一点”、“一圈半少一点”</span><br></pre></td></tr></table></figure></p>
<p>4 靠边停车</p>
<pre><code>靠边停车，在听到声音后，“开右转向灯3s”、“方向稳住不动”、“减速到1挡”、“然后方向盘向右稍微倾斜”、“车子线方向靠”。

车头感觉车身和线重合，后视镜位置看着差不多，否则停下之后还可微调。

“确认停好后”，回空挡拉手刹。这时会提示挺好出发。

“打左转向灯3s”、“打左半圈”、“上2挡”、“上3挡”
</code></pre><h1 id="在路上想到一个问题"><a href="#在路上想到一个问题" class="headerlink" title="在路上想到一个问题"></a>在路上想到一个问题</h1><p>在路上，我骑车时闯一个红灯10s，到下个路口时，刚好红灯10s。</p>
<p>如果我等，那刚刚闯红灯是赚了还是赔了。</p>
<p>如果我直接闯，那我是赚了多少时间？</p>
<h1 id="上线vue"><a href="#上线vue" class="headerlink" title="上线vue"></a>上线vue</h1><pre><code>yarn build

npm install -g serve

serve -s ./dist //本地先查看是否OK

将dist 文件目录放到服务器。之后nginx 指向该目录地址
</code></pre><h1 id="再讲一遍vue-build-上线的全过程"><a href="#再讲一遍vue-build-上线的全过程" class="headerlink" title="再讲一遍vue build 上线的全过程"></a>再讲一遍vue build 上线的全过程</h1><h2 id="检查当前环境"><a href="#检查当前环境" class="headerlink" title="检查当前环境"></a>检查当前环境</h2><p>确认好 /src/service/http 设置axios 的default.baseURL</p>
<p>由于本人服务器及后台代码配置为 <a href="https://gogal.ml/stratege/。路由为" target="_blank" rel="noopener">https://gogal.ml/stratege/。路由为</a> <code>/api/xxx</code></p>
<p>那么axios的基本路由配置为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">  axios.defaults.baseURL = <span class="string">'/api'</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  axios.defaults.baseURL = <span class="string">'/stratege'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">如果是本地测试环境，那么你需要到/config/index.js 里面修改dev/proxyTable:</span><br><span class="line"></span><br><span class="line">dev: &#123;</span><br><span class="line">  ...</span><br><span class="line">  proxyTable: &#123;</span><br><span class="line">    <span class="string">'/api'</span>: &#123;</span><br><span class="line">      target: <span class="string">'http://localhost:$&#123;your port&#125;'</span> <span class="comment">// 或者https://gogal.ml/stratege</span></span><br><span class="line">      secure: <span class="literal">true</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      pathRewrite: &#123;</span><br><span class="line">        <span class="string">'^/api'</span>: <span class="string">''</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样服务器才能找到同个域名下的api.</p>
<h2 id="确认好webpack-配置的uglifyjs-是开启的"><a href="#确认好webpack-配置的uglifyjs-是开启的" class="headerlink" title="确认好webpack 配置的uglifyjs 是开启的"></a>确认好webpack 配置的uglifyjs 是开启的</h2><pre><code>/config/index.js 里面出现的 *sourceMap 都改为false
</code></pre><p>这样线上代码就不会裸奔啦。</p>
<h2 id="开始build"><a href="#开始build" class="headerlink" title="开始build"></a>开始build</h2><p><code>yarn build</code></p>
<p>完成之后，先本地测试一遍：</p>
<pre><code>npm install -g serve

serve -s ./dist
</code></pre><p>然后点一点，玩一玩。</p>
<p>这时确认ok后，将dist 目录下的<em>favicon.ico</em> <em>index.html</em> <em>static 目录</em> 放到服务器 /var/www/目录下。【Filezilla】</p>
<h2 id="配置nginx-conf"><a href="#配置nginx-conf" class="headerlink" title="配置nginx.conf"></a>配置nginx.conf</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">http &#123;</span><br><span class="line">  include /etc/nginx/mime.types;</span><br><span class="line">  default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">  log_format main &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot;&apos;</span><br><span class="line">                  &apos;$status $body_types_sent &quot;$http_referer&quot;&apos;</span><br><span class="line">                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">  access_log  /var/log/nginx/access.log main;</span><br><span class="line"></span><br><span class="line">  sendfile  on;</span><br><span class="line">  keepalive_timeout 65;</span><br><span class="line"></span><br><span class="line">  server &#123;</span><br><span class="line">    listen  443 default ssl;</span><br><span class="line">    server_name www.gogal.ml gogal.ml;</span><br><span class="line"></span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate ???</span><br><span class="line">    ssl_certificate_key ???</span><br><span class="line">    # managerd by Certbot</span><br><span class="line"></span><br><span class="line">    root /var/www;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">      root /var/www;</span><br><span class="line">      index index.html index.htm;</span><br><span class="line">      try_files $uri $uri/ /index.html; # 作用是vue刷新 不会出现404 等情况</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location @fallback &#123;</span><br><span class="line">      rewrite ^.*$ /index.html break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /stratege/ &#123;</span><br><span class="line">      proxy_pass http://127.0.0.1:$&#123;your server port&#125;/;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>vim /etc/nginx/nginx.conf
service nginx restart
</code></pre><p>以上便能成功啦。</p>
<h1 id="曾经我问过一个成功人士-我-你为什么如此成功"><a href="#曾经我问过一个成功人士-我-你为什么如此成功" class="headerlink" title="曾经我问过一个成功人士(我),你为什么如此成功?"></a>曾经我问过一个成功人士(我),你为什么如此成功?</h1><p>成功人士(我)回答我说，当你是商人时，你便做商人的事。如果你不知道你要卖什么，那你就应该去做技术，然后将技术当成你的商品，从小做起。你没得选择。</p>
<p>不怕劳苦。当身边的人一再厌恶你的穷病时，一定要坚持住自己的理想。</p>
<p>是的，穷病，比抽烟吸毒杀人，还要可怕。而你空怀一身绝技没法及时变现。</p>
<p>你要的很多，你的身体却制约你。时常感到时间不够用，加班加点，但是一觉睡下去却远远不够。</p>
<p>成功人士，便是熬过最穷苦，依然坚持自己的愿景，含着泪坚持下去的人。</p>
<p>极度的黑暗，就是天明之时。</p>
<p>曾经的你，未来的我？现在的我？</p>
<p>希望未来能放下手中工作消遣时，回头看看这时的感叹。2019-4-30 aker</p>
<h1 id="mongodb-出现error-test-UncaughtException-E11000-duplicate-key-error-collection-authServer-users-index"><a href="#mongodb-出现error-test-UncaughtException-E11000-duplicate-key-error-collection-authServer-users-index" class="headerlink" title="mongodb 出现error - [test] UncaughtException: E11000 duplicate key error collection: authServer.users index"></a>mongodb 出现<code>error - [test] UncaughtException: E11000 duplicate key error collection: authServer.users index</code></h1><p>原因是设置unique 字段时，在多个doc 里面仍然有出现null 数据。</p>
<p>网络很多人都是建议删除数据库重来、删除索引等等。都没能解决此问题。</p>
<p>这时，使用sparse 稀疏索引 以解决此问题。</p>
<h1 id="Vue-axios-POST-请求时-会使用OPTIONS-同时解决跨域问题"><a href="#Vue-axios-POST-请求时-会使用OPTIONS-同时解决跨域问题" class="headerlink" title="Vue axios POST 请求时 会使用OPTIONS 同时解决跨域问题"></a>Vue axios POST 请求时 会使用OPTIONS 同时解决跨域问题</h1><p>OPTIONS 的解决方案：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span></span><br><span class="line"></span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">  config =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (config.method === <span class="string">'post'</span>) &#123;</span><br><span class="line">      config.data = qs.stringify(config.data)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用qs 同时在header 里面申明使用的格式</p>
<p>跨域使用Chrome 浏览器插件<strong>Moesif CORS</strong> 即可解决</p>
<h2 id="！！！！注意"><a href="#！！！！注意" class="headerlink" title="！！！！注意"></a>！！！！注意</h2><p>开发时注意，本机为黑苹果，遇到一个特别的情况：</p>
<p>昨天还能正常使用，开发dev，突然怎么改vueProject/config/index.js - proxyTable 都没用。</p>
<p>最后解决方法：使用一个新的域名代替localhost，重设置到<strong>/etc/hosts</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1：sudo vim /etc/hosts &amp;&amp; 新增 127.0.0.1  test.company.com</span><br><span class="line">2：修改proxyTable: &#123;</span><br><span class="line">  &apos;/api&apos;: &#123;</span><br><span class="line">    target: &apos;http://test.company.com:$&#123;your port&#125;&apos;,</span><br><span class="line">    secure: false,</span><br><span class="line">    changeOrigin: false,</span><br><span class="line">    pathRewrite: &#123;</span><br><span class="line">      &apos;/api&apos;: &apos;/&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3: 修改vueProject/config/index.js - dev: &#123;</span><br><span class="line">  host: &apos;test.company.com&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原因：</p>
<p>估计是本地DNS 有缓存。一直提示如下</p>
<pre><code>[HPM] Error occurred while trying to proxy

或者

axios 请求成了：POST http://localhost:${frontend port}/api/method, 服务器始终报错(本人处报：EBADCSRFTOKEN)
</code></pre><p>最终修改完成。好开心啊。</p>
<p>En:</p>
<p>I meet <code>[HPM] Error occurred while trying to proxy request</code> just today.finally solve it.</p>
<p>Scene:</p>
<p>Yesterday, VueProject worked well. Git checkout back to some week ago, still didn’t work( Used to be working well ).</p>
<p>Until this step save me:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1: sudo vim /etc/hosts &amp;&amp; 127.0.0.1   test.company.com # any host is available</span><br><span class="line">2: edit VueProject / config / index.js - proxyTable: &#123;</span><br><span class="line">  &apos;/api&apos;: &#123;</span><br><span class="line">    target: &apos;http://text.company.com:$&#123;your server port&#125;&apos;,</span><br><span class="line">    secure: false,</span><br><span class="line">    changeOrigin: false,</span><br><span class="line">    pathRewrite: &#123;</span><br><span class="line">      &apos;/api&apos;: &apos;/&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">3: edit VueProject / config / index.js - dev: &#123;</span><br><span class="line">  host: &apos;test.company.com&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="上线express-vue-两种方案"><a href="#上线express-vue-两种方案" class="headerlink" title="上线express + vue 两种方案"></a>上线express + vue 两种方案</h1><h2 id="express-vue-分开发布"><a href="#express-vue-分开发布" class="headerlink" title="express vue 分开发布"></a>express vue 分开发布</h2><pre><code>Nginx location / { root: 放Vue 路径 }
Nginx location / app { proxy 端口 }
</code></pre><p>此时只要Vue 的axios.defaults.baseURL = ‘/app’</p>
<p>以上分离很好使。但是同时维护两个，做法不太正规。</p>
<h2 id="express-vue-使用res-sendFile-Nginx-反向代理端口即可"><a href="#express-vue-使用res-sendFile-Nginx-反向代理端口即可" class="headerlink" title="express vue 使用res.sendFile Nginx 反向代理端口即可"></a>express vue 使用res.sendFile Nginx 反向代理端口即可</h2><p>下面都是重点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">docker 目录：</span><br><span class="line">/dist</span><br><span class="line">    /app.js</span><br><span class="line">    /routes/</span><br><span class="line">          /index.js 路由</span><br><span class="line">    /public/</span><br><span class="line">          /index.html</span><br><span class="line">          /static/</span><br><span class="line"></span><br><span class="line">1: Vue 前段yarn build 之后，基本不需要其他操作</span><br><span class="line"></span><br><span class="line">// 下面这句话res.sendFile 时，发送static 文件，找寻的目录.</span><br><span class="line">// 否则pc 报`Uncaught SyntaxError: Unexpected token &lt;`</span><br><span class="line">2: backend/app.ts - app.use(express.static(path.join(__dirname, &apos;public/&apos;)))</span><br><span class="line"></span><br><span class="line">// 下面这句话重点: public 不要写错，不要写错，不要写错</span><br><span class="line">// root 不是route，不是route，不是route</span><br><span class="line">3: backend/routes/index.ts - res.sendFile(&quot;index.html&quot;, &#123; root: path.join(__dirname, &apos;../public&apos;)&#125;)</span><br></pre></td></tr></table></figure>
<p>__dirname your current excuse file path</p>
<p>process.cwd() your project root path</p>
<p>以上终于解决！！！</p>
<h1 id="昨天VPS-里面的数据库Mongodb-早上还有数据，下午突然没有了"><a href="#昨天VPS-里面的数据库Mongodb-早上还有数据，下午突然没有了" class="headerlink" title="昨天VPS 里面的数据库Mongodb 早上还有数据，下午突然没有了"></a>昨天VPS 里面的数据库Mongodb 早上还有数据，下午突然没有了</h1><p>很疑惑，如果不知道原因，之后再出现就会有大问题。于是看了看里面的表。</p>
<p>知道傍晚，发现里面有张表很奇怪：叫做<code>hacked_by_unistellar</code></p>
<p>我似乎没有搞过这个表啊。</p>
<p>进去一看：db.restore.find() 显示我之前的表被脱裤，要钱，联系<a href="mailto:unistellar@hotmail.com" target="_blank" rel="noopener">unistellar@hotmail.com</a> 邮箱。</p>
<p>幸好数据不多。知道什么原因，那就好搞了。</p>
<p>首先，数据库没设置密码，那为什么会暴露在公网。</p>
<p>我启动mongo 语句是<code>docker run --name mongo -p 27017:27017 mongo</code></p>
<p>如果是直接使用mongod 那么启动时默认分配的是<strong>127.0.0.1:27017</strong></p>
<p>如果是docker 启动的话，不指定ip，docker 会直接暴露在公网，任何人直接ip + 27017 或者mysql 的3306 直接就脱裤了。</p>
<p>正确语句是：<code>docker run --name mongo -p 127.0.0.1:27017:27017 mongo</code></p>
<p>db.createUser({ user: ‘akerdi’, pwd: ‘my-fucking_password’, roles: [ { role: ‘userAdminAnyDatabase’, db: ‘admin’ } ]});</p>
<h2 id="正确思考Mongo-是什么。"><a href="#正确思考Mongo-是什么。" class="headerlink" title="正确思考Mongo 是什么。"></a>正确思考Mongo 是什么。</h2><p>数据库实质上是一个管理物理数据的软件，充当管理介质。</p>
<p>那么上面很重要的点是，mongo 需要配置文件。</p>
<pre><code>docker run -p 27017:27017 -v /mongo_configdb:/data/configdb -v /mongo_db:/data/db -d mongo # 这里重点是将配置文件映射到相应的目录。之后所有映射过来的都会使用相同配置

docker ps # 找到对应containerId

docker exec -it containerId mongo admin # 进入mongodb 或者 docker exec -it containerId bash 之后 mongo

&gt; use cool_db #mongo 内部环境，使用cool_db 为例

&gt; db.createUser({ user: &apos;aker&apos;, pwd: &apos;your password&apos;, roles: [{ role: &apos;readWrite&apos;, db: &apos;cool_db&apos;}] });

&gt; exit

$ docker stop containerId &amp;&amp; docker rm containerId # 之后使用 --auth 之前的mongo 软件介质不需要了

# 这时使用之前映射的目录，便是相同的配置，同时mongo 还带有验证
# 127.0.0.1:27017 可以使ip 映射局限本机，否则为0.0.0.0:27017
# --rm 使mongo 在stop 时自动删除
doceker run --name mongo -d -p 127.0.0.1:27017:27017 -v /mongo_configdb:/data/configdb -v /mongo_db:/data/db -d --rm mongo --auth
</code></pre><p>参考自：</p>
<ol>
<li><a href="https://www.jianshu.com/p/2181b2e27021" target="_blank" rel="noopener">https://www.jianshu.com/p/2181b2e27021</a></li>
<li><a href="https://stackoverflow.com/questions/34559557/how-to-enable-authentication-on-mongodb-through-docker" target="_blank" rel="noopener">https://stackoverflow.com/questions/34559557/how-to-enable-authentication-on-mongodb-through-docker</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2019/04/25/2019-3-25lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/25/2019-3-25lesson/" class="post-title-link" itemprop="url">2019-3-25lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-25 07:41:43" itemprop="dateCreated datePublished" datetime="2019-04-25T07:41:43+00:00">2019-04-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-24 23:41:54" itemprop="dateModified" datetime="2019-04-24T23:41:54+00:00">2019-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装黑苹果"><a href="#安装黑苹果" class="headerlink" title="安装黑苹果"></a>安装黑苹果</h1><h3 id="制作黑苹果至关重要的一步：选对硬件"><a href="#制作黑苹果至关重要的一步：选对硬件" class="headerlink" title="制作黑苹果至关重要的一步：选对硬件"></a>制作黑苹果至关重要的一步：选对硬件</h3><p>示例操作硬件：</p>
<blockquote>
<p>cpu: i7 8700k (不要用AMD，不好装) \<br>motherboard: Gigabyte Z370HD3P (推荐) \<br>显卡: 独显 GTX 1050ti (推荐Rx560，拆机显卡不贵，不知道链接问本人)</p>
</blockquote>
<p>好了，如果你是这硬件，你就完成80%了，否则移步<a href="https://www.tonymacx86.com/" target="_blank" rel="noopener">tonymacx86</a>找找对应硬件的配置等。安装步骤都是一样，配置和驱动不同而已。</p>
<h3 id="准备材料"><a href="#准备材料" class="headerlink" title="准备材料"></a>准备材料</h3><ol>
<li>苹果官网下的一个.dmg 系统文件。(比如high sierra 10.13.6)</li>
<li>一个16G左右U盘(系统盘大约6G 左右)</li>
<li><a href="https://sourceforge.net/projects/cloverefiboot/" target="_blank" rel="noopener">Clover EFI bootloader 下载地址</a></li>
<li><a href="https://mackie100projects.altervista.org/download-clover-configurator/" target="_blank" rel="noopener">Clover configuration 下载地址</a></li>
</ol>
<p>本教程默认使用Mac 环境下操作，制作U盘；Windows 操作google之，步骤类似。<br>本教程为纯净版Vanilla 方法(大神取得名字)至简安装方案.</p>
<h3 id="生成U盘启动器"><a href="#生成U盘启动器" class="headerlink" title="生成U盘启动器"></a>生成U盘启动器</h3><h4 id="下载对应系统"><a href="#下载对应系统" class="headerlink" title="下载对应系统"></a>下载对应系统</h4><p><a href="https://pan.baidu.com/s/1Ujfi8X6hBDuQVlSWuulNbw" target="_blank" rel="noopener">百毒云 10.13.6 下载地址</a>(下载慢找我，不要花钱买百毒云会员)</p>
<p>双击系统.dmg 文件，安装成为app，移到/finder/Applications</p>
<h4 id="制作U盘启动器-白苹果U盘启动器"><a href="#制作U盘启动器-白苹果U盘启动器" class="headerlink" title="制作U盘启动器(白苹果U盘启动器)"></a>制作U盘启动器(白苹果U盘启动器)</h4><p>打开-Mac磁盘工具，点击顶部<strong>显示所有设备</strong>，找到你的U盘，点击<strong>抹掉</strong></p>
<ol>
<li>U盘取名macinstaller</li>
<li>格式为Mac OS Extended(Journaled) -&gt; Mac OS 拓展(日志式)</li>
<li>方案: GUID分区图</li>
</ol>
<p>完成后退出</p>
<p>打开terminal</p>
<blockquote>
<p>sudo ${系统.app 拖到此处}/Contents/Resources/createinstallmedia –volume /Volumes/macinstaller</p>
</blockquote>
<p>前面是系统盘制作路径，后面volume 空间是抹掉取名为macinstaller 的U盘路径</p>
<p>然后就是开始加载，时间比较久，直到出现<code>Install media now available at &quot;/Volumes/Install macOS high sierra&quot;</code></p>
<h4 id="黑苹果引导Clover"><a href="#黑苹果引导Clover" class="headerlink" title="黑苹果引导Clover"></a>黑苹果引导Clover</h4><p>之前制作白苹果步骤完成。下面使用Clover 转黑苹果</p>
<p><a href="https://sourceforge.net/projects/cloverefiboot/" target="_blank" rel="noopener">Clover EFI bootloader 下载地址</a></p>
<p>点击下载的Clover</p>
<ol>
<li>介绍 - 继续</li>
<li>请先阅读 - 继续</li>
<li>目的宗卷 - 更改安装位置：选择我们的白苹果U盘</li>
<li>安装类型 - 安装</li>
<li>安装 - 选择(仅安装UEFI 开机版本、安装Clover 到EFI 系统区)(UEFI Drivers 下拉仅选择VBoxHfs-64、ApfsMemoryFix-64、AptioMemoryFix-64) ,其他都不选；然后点击安装</li>
<li>安装完成关闭</li>
</ol>
<h4 id="config-plist"><a href="#config-plist" class="headerlink" title="config.plist"></a>config.plist</h4><p><a href="https://mackie100projects.altervista.org/download-clover-configurator/" target="_blank" rel="noopener">Clover configuration 下载地址</a></p>
<ol>
<li>Mount EFI - Efi Partitions - U盘分区 - 点击Mount Partition 并输入电脑密码</li>
<li>Mount EFI - Efi Partitions - U盘分区 - 点击Open Partition 打开文件夹</li>
<li>EFI - CLOVER - config.plist 使用Clover configuration 打开</li>
<li>Kexts Installer - OS Version下拉选择Other</li>
<li>Kexts Installer - 选择Lilu、WhateverGreen、FakeSMC 点击下载</li>
<li>步骤【5】下载完弹出框，选中全部的5个传感器全部install</li>
<li><a href="https://github.com/corpnewt/Hackintosh-Guide/blob/master/Configs/CoffeeLake/config.plist" target="_blank" rel="noopener">新的config.plist</a>替换现在U盘Mount的EFI - CLOVER - config.plist</li>
<li>clover configuration 打开U盘的Mount的EFI</li>
<li>SMBIOS 选择iMac17.1</li>
</ol>
<p>U盘启动器至此全部完成</p>
<h3 id="安装黑苹果-1"><a href="#安装黑苹果-1" class="headerlink" title="安装黑苹果"></a>安装黑苹果</h3><h4 id="BIOS设置"><a href="#BIOS设置" class="headerlink" title="BIOS设置"></a>BIOS设置</h4><blockquote>
<p>Intel Virtualization Technology: Enabled (docker 要用) \<br>Vt-d:disable<br>XHCI Handoff: enabled (不然USB 等设备没法识别) \<br>Fast Boot: Disabled \<br>Secure Boot/OS Type: Other OS (有就选) \<br>SATA to AHCI \<br>Boot 启动使用U盘 Partition</p>
</blockquote>
<h4 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h4><ol>
<li>在Clover 引导界面选择名为<code>Boot macOS Install from macOS high sierra</code>(默认第一个)</li>
<li>安装进入verbose 啰嗦模式</li>
<li>会自动重启几次</li>
<li>之后进入macOS Utilities(macOS 使用工具)</li>
<li>使用磁盘工具抹掉磁盘</li>
<li>点击顶部<strong>显示所有设备</strong>，找到你要安装硬盘，点击抹掉：名字取macos；类型：【1】 U盘取名macinstaller【2】 格式为Mac OS Extended(Journaled) -&gt; Mac OS 拓展(日志式)【3】 方案: GUID分区图</li>
<li>回到macOS Utilities 界面，选择Install macOS</li>
<li>【确定】【确定】之后，选择你要安装的安装盘macos</li>
<li>安装过程会重启几次，确保从硬盘启动而不是U盘启动(默认帮你选好了，确定下即可)</li>
</ol>
<h4 id="选择国家界面"><a href="#选择国家界面" class="headerlink" title="选择国家界面"></a>选择国家界面</h4><p>选中国</p>
<p>然后一直点下一步，能跳过则跳过。之后再设置。</p>
<p>创建电脑账户(这个名字一定要取好，之后不好改；有mac 系统的大bug)</p>
<h4 id="替换U盘启动EFI-至硬盘启动EFI"><a href="#替换U盘启动EFI-至硬盘启动EFI" class="headerlink" title="替换U盘启动EFI 至硬盘启动EFI"></a>替换U盘启动EFI 至硬盘启动EFI</h4><ol>
<li>clover configuration - Mount EFI - 挂载Mount U盘、macOS 的EFI分区</li>
<li>将U盘的EFI 整个替换硬盘的EFI文件夹</li>
</ol>
<h4 id="拔出U盘-重启启动"><a href="#拔出U盘-重启启动" class="headerlink" title="拔出U盘 重启启动"></a>拔出U盘 重启启动</h4><p>Boot 使用硬盘的Partition 启动</p>
<h3 id="查找驱动"><a href="#查找驱动" class="headerlink" title="查找驱动"></a>查找驱动</h3><p>黑苹果难就难在找驱动，通过查找通用驱动为例。</p>
<blockquote>
<p>屏幕左上角🍎 - 关于本机 - 系统报告 查看确实的驱动 \<br>比如缺失以太网卡、音频 \<br>去主板官网确认网卡声卡的型号 \<br>比如Gigabyte z370 HD3P - 产品规格 - 音效 - <strong>内建Realtek@ ALC1220</strong> 那么下载<a href="https://github.com/acidanthera/AppleALC/releases" target="_blank" rel="noopener">AppleALC</a> \<br><a href="https://bitbucket.org/RehabMan/os-x-intel-network/src" target="_blank" rel="noopener">网卡驱动</a></p>
</blockquote>
<p>NVIDIA webDriver驱动可以直接安装对应驱动：<a href="https://www.tonymacx86.com/threads/nvidia-releases-alternate-graphics-drivers-for-macos-high-sierra-10-13-6-387-10-10-10-40.255913/" target="_blank" rel="noopener">NVIDIA webDriver</a></p>
<p>如果是集成显卡UHD Graphics 630：</p>
<ol>
<li>clover configuration打开硬盘EFI - CLOVER - config.plist</li>
<li>Devices &gt; FakeID &gt; IntelGFX = 0x59128086</li>
<li>Graphics &gt; ig-platform-id = 0x59120000</li>
<li>Graphics &gt; 打钩Inject Intel(似乎有点重要,否则还是会闪,显卡7M)</li>
<li>SMBIOS &gt; Select iMac17.1</li>
</ol>
<p>有双屏幕需求的，DVI + HDMI 插上没反应的可以试试：</p>
<ol>
<li>Clover configuration - Graphics - NVCap: 04000000 00000100 0E000000 00000007 00000000</li>
<li>Video Ports: 2</li>
</ol>
<p>关闭啰嗦模式：</p>
<ol>
<li>Boot - Arguments 删除<strong>-v</strong></li>
</ol>
<h4 id="驱动安装方法"><a href="#驱动安装方法" class="headerlink" title="驱动安装方法"></a>驱动安装方法</h4><p>把下载下来的.kext 驱动放到硬盘的EFI - CLOVER - kexts - Other 下，重启即可生效。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://zhuanlan.zhihu.com/p/55256660" target="_blank" rel="noopener">黑苹果麦金塔</a></p>
<p><a href="https://www.tonymacx86.com" target="_blank" rel="noopener">tonymacx86</a></p>
<p><a href="https://blog.daliansky.net/macOS-High-Sierra-10.13.6-17G65-Release-Version-with-Clover-4596-original-mirror.html" target="_blank" rel="noopener">windows 制作mac参考</a></p>
<p><a href="https://www.tonymacx86.com/threads/success-8700k-gigabyte-z370-hd3p-uhd-graphics-630-macos-high-sierra-mojave.239402/" target="_blank" rel="noopener">tonymacx86 - i7 8700k</a></p>
<p><a href="https://www.tonymacx86.com/threads/nvidia-releases-alternate-graphics-drivers-for-macos-high-sierra-10-13-6-387-10-10-10-40.255913/" target="_blank" rel="noopener">tonymacx86 - Nvidia webDriver</a></p>
<p><a href="https://github.com/enify/blog/issues/2" target="_blank" rel="noopener">windows 制作mac参考2</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2019/04/25/2019-4-22lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/25/2019-4-22lesson/" class="post-title-link" itemprop="url">2019-4-22lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-25 07:40:34" itemprop="dateCreated datePublished" datetime="2019-04-25T07:40:34+00:00">2019-04-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-24 23:42:22" itemprop="dateModified" datetime="2019-04-24T23:42:22+00:00">2019-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>记录最近将近一个月的生活</p>
<p>新工作进展的很顺利。我们老大实力很强，为人也相当平顺。简直就是佩服这些老大。<br>我表示，我的人生轨迹永远都是运气超级好的那个，很神奇。比如，我考大学；学计算机；做网管；出来实习iOS；iOS的几年；碰到可爱的老婆；生了个阿黄；转岗顺利。不过好运大家都有，都围绕自己转，不过很多人没去努力抓住罢了。可能中间哪里间歇，断档了，那当然好运就断了。就比如，有时你会发现，你过红绿灯，一路都是绿灯。<br>刚进公司完成这几个大功能（老大分配的任务非常适合我成长，循序渐进那种）：</p>
<ol>
<li>注册增加nickname</li>
<li>网页界面显示版本号</li>
<li>mongo 对日志保存一年</li>
<li>用户下载软件，保存日志</li>
<li>用户绑定手机号，填写验证码。绑定、解除绑定、登录二次验证过程，oauth登录页面二次验证(第三方库参数外部输入)</li>
<li>vue 提取component</li>
<li>管理员 管理用户界面-管理员增加筛选功能</li>
<li>完成后端接口请求次数限制功能</li>
<li>修改浏览器退出，再进入页面，此时却需要重新登录bug(主要前段bug，cookie 存在内存中，web客户端死了，便需要重启了)</li>
<li>解决用户登录后退出，frontend 会多次请求profile bug</li>
<li>提供客户端VMProtect 接口。实现【1】 管理员输入secret 等；【2】和脚本(keyGen)交换信息返回客户端</li>
<li>完成多个license 增加、修改</li>
<li>用户授权页面排序(前段加后端)</li>
<li>backend抽取license 模块</li>
<li>增加editor 编辑者权利范围</li>
<li>将个人中心 重写成Typescript</li>
</ol>
<p>工作中是如此。尽我最大努力去学习、熟悉、解决错误。</p>
<p>学科目二大概4、5次就去考试了，最重要的是压离合，压的我腿都酸了。考试前一周日，我选择400块套餐，教练带着我走了1、2、3号线真实考试场景；本来有意再花500块，考试内的考试教官一些<em>特殊服务</em>，但是想想自己试试，应该没太大问题的(看来是对的，其实教官就是在出发时，对你很温柔-交钱了嘛；倒车时稍微喊一喊，其他没什么帮助，省了一笔巨款)。<br>科目二19.4.2 早早去考场，拿完号再去转了一圈,就去考场坐着等考试.<br>轮到我进去，把号拿了，手机放到柜子去一个房间等。好多人在门前等在叫号，一些人先去考了，有高兴的回来的，有沮丧不开心的。我看着他们，内心平淡。然后过了很久，大概要叫到我了吧，开始有一丢丢紧张，然后我告诉自己，我有不得不过的理由，不能把时间耗在这里。方法很有效。<br>我的叫号到了”一号线“，我平淡的前往车子，启动，慢慢往前，还是和压离合一样。<br>第一个坎：倒车入库。我把车子最高点对准前方标杆，倒车时肩膀线对准水管头，往右打死，慢慢倒车。发现有压线的可能，于是我把方向盘往左打一些，然后再往右打死，然后车子还是压线了，挂了。很不甘心，后面都没尝试就挂了。然后见没人喊，我就继续把左边倒库试一遍。发现管理台有人喊我回原点重考。好吧，于是我开回去，让师傅调试重考了。</p>
<p>重考时慢慢往前，前面转弯处有两辆车堵在那里，蛋疼，还没从刚才失败情绪中，但是我要将其转化为动力，我有不得不过的理由！前方通车，我往前，得，倒车有一个菇凉考试，那就停在那里等她。等了好久，那姑娘考完倒库，没挂，然后从左边出库。？what？左边是入口咋出去！于是她前倒后倒，把自己时间超时，被考官喊回去了。悲伤的故事。</p>
<p>轮到我了，我慢慢往前，把车子摆正，最高点正对标杆。倒退时，肩膀线正对水管头，稍微再过10公分(有个过度黑框)然后右打死。慢慢倒着，然后进来后，发现没叫，说明没问题。于是出库，肩膀线对准左边第一个柱子，左打死。倒车时，肩膀线对准左边一个标志物，左打死，车子慢慢倒入库中，左肩膀线对准一个框框内，停稳。没叫，没叫说明我安全了。于是我小心的出库，往前侧方停车。<br>路上左后镜保证不压线即可，最高点正对一个模糊的线。往前有个标志点对准肩膀线停下。往后倒，肩膀线对准左边一个砖头，右打死；左后镜看到第一个黄黑交接，方向盘回一半，再看到一个黄黑交接，反向盘回完，往后倒，左轮轧着晃条，左打死，再慢慢退，注意看右后视镜中车身和线平行，停下，回空挡，拉手刹。出库时，先上一档，出发，然后最高点对准标志物回完，稍微往前一点，右打死，车身快摆正时回完。这个地方要小心，很窄，容易压线，否则就挂了。这两个最麻烦的完了，接下来好很多。前方是直角转弯，一路有点小激动，腿有点小抖。<br>激动也要完成，不能松懈！最高点最准，肩膀线到标志物左打死，成功过关。下一关坡道定点。<br>我上去时，最高点对准，左侧不能压线，那就往有一点点，扣分就扣分吧，然后最高点肩膀线对其。fuck，左边两辆车，看不见！不过老子高啊！！！我看得见歪脖子树！！！于是安安全全停下。拉手刹3s，放下手刹，慢抬离合，稳住离合，慢放刹车。又成功。下一个s弯。<br>s弯算是比较好过的，一定要慢，科目二就是学习压离合，慢，蠕动，反正不限时，不要停下被扣分就可以了。s弯过去最后一格障碍物有点突出稍微小心，往左拉一点，然后往右拉一点，进入窄路掉头。<br>窄路掉头其实挺宽的，倒的时候稍微多贪心一点点，安全就好，然后很平顺就出去了。出去时，小心别压线。<br>难得都没了，接下来是上海多考的3项：进隧道、模拟高速停车打卡、紧急情况处置。(我再窄路掉头就已经开启灯了，管他呢，想怎么开就怎么开，不算扣分的，教练说)，倒数第二个栏关掉灯光。<br>模拟高速停车打卡，离合位置对准路上钉子，到位停车，回空挡拉手刹，然后上一档，放手刹。出发时稍微往右点(不然之前往左靠拢可能继续前行不小心碰到线，挂了)。<br>紧急停车，就是听到播报，立即停车然后打开紧急灯光，闪8下，继续往前。<br>往前就回到原点了。<br>教官出来说我考通过了，我想问多少分，他说过了就好了，管他多少分。算了，心情好，不知道无所谓，我没给教官好处，肯定是这个态度。哈哈。社会是用钱打通的。<br>给同是张教练一起考试的同学大拇指，成功，给她们点安慰和鼓励。<br>我出去和张教练报喜，顺便等另两位考试菇凉好运。<br>一起的另一个大叔，第二次考还是失败，没有模拟过。好懊悔，一直表示，还是要模拟，等会就去模拟。然后两位菇凉出来，也说没过。悲伤的故事，今天考试的就我一个通过了。<br>回去上班去了，心情大好。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2019/04/25/2019-3-27lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/25/2019-3-27lesson/" class="post-title-link" itemprop="url">2019-3-27lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-25 07:40:25" itemprop="dateCreated datePublished" datetime="2019-04-25T07:40:25+00:00">2019-04-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-24 23:42:09" itemprop="dateModified" datetime="2019-04-24T23:42:09+00:00">2019-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="connect-mongo-用户登录后杀死浏览器-用户还得重新登录-bug-解决过程"><a href="#connect-mongo-用户登录后杀死浏览器-用户还得重新登录-bug-解决过程" class="headerlink" title="connect-mongo 用户登录后杀死浏览器,用户还得重新登录 - bug 解决过程"></a>connect-mongo 用户登录后杀死浏览器,用户还得重新登录 - bug 解决过程</h3><p>表现为用户正常登录。cookie、session 被正常记录。把浏览器关闭又打开时，需要重新登录。</p>
<p>猜测：</p>
<ol>
<li>cookie 没有记录</li>
</ol>
<p>不对，记录了。front 在<strong>SignIn</strong>时<code>Cookies.set(&#39;secret&#39;, userInfo)</code>。每次打开时都是有的。</p>
<ol start="2">
<li>session 没有记录</li>
</ol>
<p>流程对的。cookieParser、expressSession、passport.initialize、passport.session、passport.serilizeUser、passport.deserializeUser</p>
<p>但是注意到mongo 的session 表里面，expires、originalMaxAge 等都为null,说明session 写进去了，但是设置session expire 方式不对：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.use(expressSession(&#123;</span><br><span class="line">    name:</span><br><span class="line">    secret</span><br><span class="line">    maxAge: expireTime</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">以上设置过期时间方法不对，可以使用下面两种方法之一：</span><br><span class="line"></span><br><span class="line">[1] 全部永久统一设置</span><br><span class="line">expressSession(&#123;</span><br><span class="line">    name:</span><br><span class="line">    secret:</span><br><span class="line">    cookie:</span><br><span class="line">        maxAge: expireTime //这是统一设置方式的正确方式</span><br><span class="line">&#125;)</span><br><span class="line">[2] 灵活设置session过期时间</span><br><span class="line">用户确认登录后，使用req.session.cookie.expire = expireTime</span><br></pre></td></tr></table></figure>
<p>以上正确的解决了session 设置过期问题。</p>
<p>然后接下来尝试登录操作。发现登录后，退出浏览器，重新打开浏览器并进入页面，发现又打开了登录页。</p>
<p>难道问题还在？首先排除之前已经成功解决了cookie session 设置问题；是backend 有问题还是frontend 有问题？</p>
<p>这时尝试使用浏览器打开某个没有界面的接口时，居然打开了，同时返回了用户的基本信息！说明后端的确没有问题，后端将cookie 认证过后的信息正确的返回了。</p>
<p>后端校验没有问题，那么该问题就可能由frontend产生，frontend自己验证，自己处理了该route？</p>
<p>尝试找了下源码，确实发现了其在route.beforeEach(SPA 第一次加载或者重刷新调用)方法中，自我检验了一番，但是却缺少验证信息，自己误判自己。</p>
<blockquote>
<p>从上面分析得到，全栈工程需要先各自分析问题由来和可能出处。当都有问题时就会很难判别，这时可以从一些不正常的地方打开突破口，一个个解决后，才能知道靠近真相。</p>
</blockquote>
<p>这也是我第一次跟着老大一起改第一个大bug。自己没能贡献太多帮助，测试过程方法不熟练、分析来由不清晰、尝试过程比较靠蒙。</p>
<p>多多努力啊，努力才是回报老大苦心栽培！！</p>
<h3 id="U盘格式为Fat32-最多只能4G-左右内容"><a href="#U盘格式为Fat32-最多只能4G-左右内容" class="headerlink" title="U盘格式为Fat32 最多只能4G 左右内容"></a>U盘格式为Fat32 最多只能4G 左右内容</h3><p>Mac 大文件总是复制不进U盘，是因为Fat32格式原因。但是格式为NTFS 格式时Mac 又识别不了。</p>
<p>解决：取github 下载NTFS X；或者Mac 里面的NTFS 操作软件即可识别并进项curd 操作。</p>
<h3 id="同局域网传输文件方法"><a href="#同局域网传输文件方法" class="headerlink" title="同局域网传输文件方法"></a>同局域网传输文件方法</h3><p>PC.A在相关文件夹使用Python 打开权限<code>python -m SimpleHTTPServer 8000</code></p>
<p>意思是打开8000 端口。此时另一台打开浏览器，输入${PC.A.ip:8000}即可进入该文件夹。同时选取对应文件即可下载</p>
<h3 id="terminal-zsh-翻墙"><a href="#terminal-zsh-翻墙" class="headerlink" title="terminal zsh 翻墙"></a>terminal zsh 翻墙</h3><pre><code>vim ~/.zshrc # 修改terminal 源文件
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias proxy=&apos;export all_proxy=socks5://127.0.0.1:$&#123;port&#125;&apos; # port 一般为1080；查看：- 偏好设置 - 高级 - 本地Socks5监听端口</span><br><span class="line">alias unproxy=&apos;unset all_proxy&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zshrc</span><br><span class="line">curl cip.cc # 显示了国内地址</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy</span><br><span class="line">curl cip.cc # 已翻墙的地址</span><br></pre></td></tr></table></figure>
<pre><code>unproxy # 关闭翻墙
</code></pre><p><a href="https://github.com/mrdulin/blog/issues/18" target="_blank" rel="noopener">参考</a></p>
<h3 id="centos6增加Swap分区"><a href="#centos6增加Swap分区" class="headerlink" title="centos6增加Swap分区"></a>centos6增加Swap分区</h3><p>1.检查swap大小和硬盘空间</p>
<pre><code>free -m
</code></pre><p>2.添加交换文件</p>
<pre><code>mkdir -p /opt/temp
# 增加内存为2G
dd if=/dev/zero of=/opt/temp/swap bs=1024 count=2048000
</code></pre><p>3.创建交换空间</p>
<pre><code>mkswap -f /opt/temp/swap
</code></pre><p>4.启动新增加的2G交换空间</p>
<pre><code>swapon /opt/temp/swap
</code></pre><p>5.修改/etc/fstab 使新加的2G交换空间在系统重新启动后自动生效</p>
<pre><code>echo &quot;/opt/temp/swap swap swap defaults 0 0&quot; &gt;&gt;/etc/fstab
</code></pre><p>6.重新启动系统</p>
<pre><code>reboot
</code></pre><p><a href="https://blog.csdn.net/lym152898/article/details/77133260" target="_blank" rel="noopener">参考</a></p>
<h3 id="Dockerfile-容器不能连接另一个容器的端口"><a href="#Dockerfile-容器不能连接另一个容器的端口" class="headerlink" title="Dockerfile 容器不能连接另一个容器的端口"></a>Dockerfile 容器不能连接另一个容器的端口</h3><p>错误原因是自身错误，情况：我以前就是写127.0.0.1 连接本地mongo、redis，但是我忘了我以前使用的是docker-compose</p>
<p>我现在不想用docker-compose，操作是使用真实物理地址, 如192.168.1.2、server Ip，反正不能为127.0.0.1 即可。</p>
<p>这样即可成功，仅仅只是这个错误.</p>
<p>导致我一个大中午在：构建容器400多M、上传容器、运行-出错，反复。本地debug运行都是可以连接的。然后我本地使用容器，咦，果然连不上。</p>
<h3 id="重新Certbot-auto"><a href="#重新Certbot-auto" class="headerlink" title="重新Certbot-auto"></a>重新Certbot-auto</h3><p>域名过期，重新搞了个免费的域名:gogal.ml <a href="freenom.com">官网</a><br>控制台等会还要用到，需要填写certbot token</p>
<p>首先去<a href="https://certbot.eff.org/lets-encrypt" target="_blank" rel="noopener">certbot 官网</a>，我选择centos6-nginx 于是是这里-<a href="https://certbot.eff.org/lets-encrypt/centos6-nginx" target="_blank" rel="noopener">直达</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cd</span> ~/</span><br><span class="line"><span class="variable">$mkdir</span> download &amp;&amp; <span class="built_in">cd</span> download</span><br><span class="line"><span class="variable">$wget</span> https://dl.eff.org/certbot-auto</span><br><span class="line"><span class="variable">$sudo</span> mv certbot-auto /usr/<span class="built_in">local</span>/bin/certbot-auto</span><br><span class="line"><span class="variable">$sudo</span> chown root /usr/<span class="built_in">local</span>/bin/certbot-auto</span><br><span class="line"><span class="variable">$sudo</span> chmod 0755 /usr/<span class="built_in">local</span>/bin/certbot-auto</span><br><span class="line"></span><br><span class="line"><span class="variable">$pip</span> install certbot-nginx</span><br></pre></td></tr></table></figure>
<p>到这里需要先前去nginx.conf 填写对应443 的server_name。 比如：server_name <a href="http://www.gogal.ml" target="_blank" rel="noopener">www.gogal.ml</a> gogal.ml;下面会用到</p>
<p>$/usr/local/bin/certbot-auto –server <a href="https://acme-v02.api.letsencrypt.org/directory" target="_blank" rel="noopener">https://acme-v02.api.letsencrypt.org/directory</a> –manual –preferred-challenges dns  –installer nginx -d *.gogal.ml -d gogal.ml # gogal.ml 就是我的域名</p>
<p>前几句都可以直接忽略，yes or enter</p>
<p>直到出现这句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Please deploy a DNS TXT record under the name</span><br><span class="line">_acme-challenge.gogal.ml with the following value:</span><br><span class="line"></span><br><span class="line">EfurJLgnrwahc7g_6k7odGVXp6sffOruJaDceBdiAmU</span><br><span class="line"></span><br><span class="line">Before continuing, verify the record is deployed.</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></pre></td></tr></table></figure>
<p>这时将里面那个拷贝到freenom 控制台-managedns</p>
<p>Add Records</p>
<p>name 填 <strong>_ACME-CHALLENGE</strong><br>Target 填 <strong>${你自己得到的那个，比如EfurJLgnrwahc7g_6k7odGVXp6sffOruJaDceBdiAmU}</strong></p>
<p>回到ssh 按下enter 键，之后还有几步都没那么关键了。</p>
<p>这时你用postman 可以测试，之前的都是可用的了。</p>
<p>这里提一点：一开始我碰到certbot 升级的问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line"></span><br><span class="line">How would you like to authenticate with the ACME CA?</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">1: Nginx Web Server plugin (nginx)</span><br><span class="line">2: Spin up a temporary webserver (standalone)</span><br><span class="line">3: Place files in webroot directory (webroot)</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Select the appropriate number [1-3] then [enter] (press &apos;c&apos; to cancel): 1</span><br><span class="line">Plugins selected: Authenticator nginx, Installer None</span><br><span class="line">Obtaining a new certificate</span><br><span class="line">Performing the following challenges:</span><br><span class="line">http-01 challenge for gogal.ml</span><br><span class="line">Client with the currently selected authenticator does not support any combination of challenges that will satisfy the CA. You may need to use an authenticator plugin that can do challenges over DNS.</span><br><span class="line">Client with the currently selected authenticator does not support any combination of challenges that will satisfy the CA. You may need to use an authenticator plugin that can do challenges over DNS.</span><br></pre></td></tr></table></figure>
<p>我就是直接前往官网，下载最新的certbot-auto 即解决了。</p>
<h3 id="利用Vue-2-x-Templates-Legacy-脚手架搭建项目"><a href="#利用Vue-2-x-Templates-Legacy-脚手架搭建项目" class="headerlink" title="利用Vue 2.x Templates(Legacy) 脚手架搭建项目"></a>利用Vue 2.x Templates(Legacy) 脚手架搭建项目</h3><p><a href="https://cli.vuejs.org/guide/creating-a-project.html#vue-create" target="_blank" rel="noopener">Vue 官网</a></p>
<pre><code>yarn global add @vue/cli-init

vue init webpack &lt;my-project&gt;
</code></pre><p>接下来就可以愉快的写了</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2019/02/19/2019-2-19lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/19/2019-2-19lesson/" class="post-title-link" itemprop="url">2019-2-19lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-19 00:04:38" itemprop="dateCreated datePublished" datetime="2019-02-19T00:04:38+00:00">2019-02-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-03 00:14:34" itemprop="dateModified" datetime="2019-03-03T00:14:34+00:00">2019-03-03</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="记录最近学习nodejs"><a href="#记录最近学习nodejs" class="headerlink" title="记录最近学习nodejs"></a>记录最近学习nodejs</h1><h2 id="V8引擎-对类操作的加速"><a href="#V8引擎-对类操作的加速" class="headerlink" title="V8引擎 对类操作的加速"></a>V8引擎 对类操作的加速</h2><p>V8 引擎是google 邀请巴克为chrome 写的通用js底层引擎。<br>V8 创建类采用aClass = {}，如果有新的属性，则会生成一个隐藏bClass = { this.name = “b” }， 同时将aClass 指向bClass。aClass 会因为js 的GC 技术稍后销毁。这将带来巨大的性能优化。</p>
<p>最佳做法：一次性声明aClass 属性，且尽量不要用 delete 方法。</p>
<h2 id="CommonJS-类如何分割"><a href="#CommonJS-类如何分割" class="headerlink" title="CommonJS 类如何分割"></a>CommonJS 类如何分割</h2><p>web 全局有window，node 全局有global属性。相当于<code>var a = 0</code>;全局都会有<code>a</code>属性。<br>CommonJS 采用给每个被加载出来的js文件都变成某个函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> name = aKer;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>这时就变成一个个模块。</p>
<h2 id="js-定义类的方法："><a href="#js-定义类的方法：" class="headerlink" title="js 定义类的方法："></a>js 定义类的方法：</h2><p>参考自：<a href="https://www.cnblogs.com/meteorcn/p/node_mianshiti_interview_question.html" target="_blank" rel="noopener">https://www.cnblogs.com/meteorcn/p/node_mianshiti_interview_question.html</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">构造函数方法定义类</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">"aKer"</span></span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; alert(<span class="keyword">this</span>.name) &#125;</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person();</span><br><span class="line">person.sayName()</span><br><span class="line"></span><br><span class="line">对象创建方法定义类</span><br><span class="line"><span class="keyword">var</span> Person = &#123;</span><br><span class="line">    name: <span class="string">"aKer"</span>,</span><br><span class="line">    sayName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; alert(<span class="keyword">this</span>.name); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = <span class="built_in">Object</span>.create(Person);</span><br><span class="line">person.sayName();</span><br><span class="line"></span><br><span class="line">极简主义法(参考自 阮一峰博客), 推荐使用</span><br><span class="line"><span class="keyword">var</span> Cat = &#123;</span><br><span class="line">    createNew: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> cat = &#123;&#125;;</span><br><span class="line">        cat.name = <span class="string">"aBai"</span>;</span><br><span class="line">        cat.makeSound = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; alert(<span class="string">"mmm"</span>); &#125;;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> cat1 = Cat.createNew();</span><br><span class="line">cat1.makeSound();</span><br><span class="line">这时继承就会如：</span><br><span class="line"><span class="keyword">var</span> Animal = &#123;</span><br><span class="line">    createNew: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> animal = &#123;&#125;;</span><br><span class="line">        animal.sleep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(<span class="string">"sleep"</span>); &#125;;</span><br><span class="line">        <span class="keyword">return</span> animal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Cat = &#123;</span><br><span class="line">    createNew: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> cat = Animal.createNew();</span><br><span class="line">        cat.name = <span class="string">"aHei"</span>;</span><br><span class="line">        cat.makeSound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(<span class="string">"mmm"</span>); &#125;;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> cat1 = Cat.createNew();</span><br><span class="line">cat1.sleep();</span><br></pre></td></tr></table></figure>
<h2 id="js类继承方法："><a href="#js类继承方法：" class="headerlink" title="js类继承方法："></a>js类继承方法：</h2><ul>
<li>原型链法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">"animal"</span>;</span><br><span class="line">&#125;</span><br><span class="line">Animal.prototype.sayName = &#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Person.prototype = Animal.prototype;</span><br><span class="line">Person.prototype.constructor = <span class="keyword">new</span> Animal;</span><br></pre></td></tr></table></figure>
<ul>
<li>属性自制法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (prop <span class="keyword">in</span> Animal.prototype) &#123;</span><br><span class="line">    Person.prototype[prop] = Animal.prototype[prop];</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.constructor = <span class="string">"Person"</span>;<span class="comment">//or new Person</span></span><br></pre></td></tr></table></figure>
<ul>
<li>构造器应用法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Animal.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="js常用设计模式：单例，工厂，代理，装饰，观察者模式"><a href="#js常用设计模式：单例，工厂，代理，装饰，观察者模式" class="headerlink" title="js常用设计模式：单例，工厂，代理，装饰，观察者模式"></a>js常用设计模式：单例，工厂，代理，装饰，观察者模式</h2><ul>
<li><p>单例</p>
</li>
<li><p>工厂：同样形式参数返回不同实例</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Factory</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Factory.prototype.getInstance = <span class="function"><span class="keyword">function</span>(<span class="params">className</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(<span class="string">"new"</span> + className + <span class="string">"()"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.name = <span class="string">"Person1"</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.name = <span class="string">"Animal1"</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> factory = <span class="keyword">new</span> Factory();</span><br><span class="line"><span class="keyword">var</span> person1 = factory.getInstance(<span class="string">"Person"</span>);</span><br><span class="line"><span class="keyword">var</span> animal1 = factory.getInstance(<span class="string">"Animal"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>代理</p>
</li>
<li><p>观察者</p>
</li>
</ul>
<h2 id="实现一个简单的http服务器"><a href="#实现一个简单的http服务器" class="headerlink" title="实现一个简单的http服务器"></a>实现一个简单的http服务器</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span> &#125;);</span><br><span class="line">    res.write(<span class="string">"aaa"</span>);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="child-process"><a href="#child-process" class="headerlink" title="child_process"></a>child_process</h2><ul>
<li>spawn</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cp = <span class="built_in">require</span>(<span class="string">"child_process"</span>);</span><br><span class="line"><span class="keyword">var</span> child = cp.spawn(<span class="string">"echo"</span>, [<span class="string">"you"</span>, <span class="string">"hellow"</span>]);</span><br><span class="line">child.stdout.pipe(process.stdout);</span><br></pre></td></tr></table></figure>
<ul>
<li>fork</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fork-parent.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cp = <span class="built_in">require</span>(<span class="string">"child_process"</span>);</span><br><span class="line"><span class="keyword">var</span> child = cp.fork(<span class="string">"./fork-child.js"</span>);</span><br><span class="line">child.on(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"parent get message from child"</span>, msg);</span><br><span class="line">&#125;)</span><br><span class="line">child.send(<span class="string">"parent send msg to child"</span>);</span><br><span class="line"></span><br><span class="line">fork-child.js</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"child get msg from parent:"</span>, msg);</span><br><span class="line">    process.send(<span class="string">"child send msg to parent to ask for money!"</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="判断用户密码时要注意什么"><a href="#判断用户密码时要注意什么" class="headerlink" title="判断用户密码时要注意什么"></a>判断用户密码时要注意什么</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkApiKey</span>(<span class="params">apiKeyFromDb, apiKeyReceived</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (apiKeyFromDb === apiKeyReceived) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>比较密码时，不能泄露任何信息，因此比较必须在固定时间完成。否则，可以使用<a href="https://en.wikipedia.org/wiki/Timing_attack" target="_blank" rel="noopener">timing attacks</a>来攻击你的应用。为什么会这样呢?Node.js使用V8引擎，它会从性能角度优化代码。它会逐个比较字符串的字母，一旦发现不匹配时就停止比较。当攻击者的密码更准确时，比较的时间越长。因此，攻击者可以通过比较的时间长短来判断密码的正确性。使用cryptiles可以解决这个问题:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkApiKey</span>(<span class="params">apiKeyFromDb, apiKeyReceived</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> cryptiles.fixedTimeComparison(apiKeyFromDb, apiKeyReceived)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="MySql-索引为什么SELECT-速度快"><a href="#MySql-索引为什么SELECT-速度快" class="headerlink" title="MySql 索引为什么SELECT 速度快"></a>MySql 索引为什么SELECT 速度快</h2><p><strong>引自廖雪峰大大</strong></p>
<blockquote>
<p>索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如gender列，大约一半的记录值是M，另一半是F，因此，对该列创建索引就没有意义。\<br>\<br>可以对一张表创建多个索引。索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。\<br>\<br>对于主键，关系数据库会自动对其创建主键索引。使用主键索引的效率是最高的，因为主键会保证绝对唯一。</p>
</blockquote>
<h2 id="随机生成密码方法"><a href="#随机生成密码方法" class="headerlink" title="随机生成密码方法"></a>随机生成密码方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function randomString(length)</span><br><span class="line">&#123;</span><br><span class="line">    var charset = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;;</span><br><span class="line">    var i;</span><br><span class="line">    var result = &quot;&quot;;</span><br><span class="line">    var isOpera = Object.prototype.toString.call(window.opera) == &apos;[object Opera]&apos;;</span><br><span class="line">    if(window.crypto &amp;&amp; window.crypto.getRandomValues)</span><br><span class="line">    &#123;</span><br><span class="line">        values = new Uint32Array(length);</span><br><span class="line">        window.crypto.getRandomValues(values);</span><br><span class="line">        for(i=0; i&lt;length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            result += charset[values[i] % charset.length];</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    else if(isOpera)//Opera&apos;s Math.random is secure, see http://lists.w3.org/Archives/Public/public-webcrypto/2013Jan/0063.html</span><br><span class="line">    &#123;</span><br><span class="line">        for(i=0; i&lt;length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            result += charset[Math.floor(Math.random()*charset.length)];</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    else throw new Error(&quot;Your browser sucks and can&apos;t generate secure random numbers&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">alert(randomString(10))</span><br></pre></td></tr></table></figure>
<h2 id="BDD-TDD-区别"><a href="#BDD-TDD-区别" class="headerlink" title="BDD/TDD 区别"></a>BDD/TDD 区别</h2><p><strong>此为其他处转载，忘记出处，侵权删</strong></p>
<p>BDD是一种敏捷软件开发的技术。它对TDD的理念进行了扩展，在TDD中侧重点偏向开发，通过测试用例来规范约束开发者编写出质量更高、bug更少的代码。而BDD更加侧重设计，其要求在设计测试用例的时候对系统进行定义，倡导使用通用的语言将系统的行为描述出来，将系统设计和测试用例结合起来，从而以此为驱动进行开发工作。</p>
<h2 id="柯里化函数"><a href="#柯里化函数" class="headerlink" title="柯里化函数"></a>柯里化函数</h2><p><strong>此为其他处转载，忘记出处，侵权删</strong></p>
<p>ES 5的 bind()方法。<br>在pomelo的一些demo 里面可能会不理解这么一句话<br>session.on(‘closed’, onUserLeave.bind(null, this.app));</p>
<p>var onUserLeave = function(app, session) {<br>  if(!session || !session.uid) {<br>        return;<br>    }<br>    app.rpc.chat.chatRemote.kick(session, session.uid, app.get(‘serverId’), session.get(‘rid’), null);<br>};<br>你可能会有这样的疑问</p>
<ol>
<li>为什么onUserLeave 会有两个参数? </li>
<li>函数的bind() 第一个参数null 什么什么意思，结合第一个问题，这里就传了一个参数？那么那个session 还是怎么传过来的？ <br>这个函数 bind() 方法是ES 5 新增的一个特性。用于将函数绑定到某个对象上。<br>那么这里bind()的方法的作用是什么呢？<br>要明白这里的bind()的用法，首先我们需要了解一种函数式编程技术—柯里化（currying）<br>Wiki是这么定义的: 在计算机科学中，柯里化（Currying），是把接受多个参数的函数变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。<br>为了帮助理解这里写一个小例子(来自于Javascript 权威指南第六版 p191)<br>var sum = function(x, y){<br> return x+y;<br>}<br>//创建一个类似于sum的新函数，但this的值绑定到null<br>//并且第一个参数绑定到1， 这个新函数的期望只传入一个实参<br>var succ = sum.bind(null, 1);</li>
</ol>
<p>console.log(succ(2)); //输出 3； x 绑定到1，并传入2作为实参</p>
<p>//另外一个做累计计算的函数<br>var sum2 = function(y ,z){<br>    return this.x + y + z;<br>}</p>
<p>//绑定this 和 y<br>var bindSum2 = sum2.bind({x : 1}, 2);<br>console.log(bindSum2(3)); //输出 6； this.x 绑定到1，y绑定到2， z 绑定到3.<br>上面这个例子就是柯里化的应用了，现在我们回到pomelo看下，chatpomelo例子里面怎么使用这个柯里化技术。<br>现在，应该能解决开头的第一个问题了，那么第二个问题，我们需要阅读一下pomelo的源码<br>阅读源码sessionService.js 464-478<br>从这十几行代码和柯里化的知识，我们就能够明白为什么onUserLeave为什么会有两个参数了。<br>var onUserLeave = function(app,  session){</p>
<p>}<br>最后的参数是通过柯里化的技术把单参数 session 传到我们多参数函数里面。</p>
<h2 id="CentOS6-Nginx-配置免费ssl"><a href="#CentOS6-Nginx-配置免费ssl" class="headerlink" title="CentOS6 Nginx 配置免费ssl"></a>CentOS6 Nginx 配置免费ssl</h2><p><a href="https://certbot.eff.org/lets-encrypt/centos6-nginx" target="_blank" rel="noopener">Certbot</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/download/</span><br><span class="line">cd /root/download/</span><br><span class="line">wget https://dl.eff.org/certbot-auto</span><br><span class="line">#设置权限</span><br><span class="line">chmod a+x certbot-auto</span><br></pre></td></tr></table></figure></p>
<p>这时得到certbot-auto 文件夹</p>
<p>./certbot-auto –nginx #这里会对nginx 服务器配置，同时会对conf 文件修改<br>(中间出现<strong>ImportError: No module named virtualenv</strong>, $pip install virtualenv)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(certbot-auto renew 刷新)</span><br><span class="line"></span><br><span class="line">//lsgood.top *.lsgood.top为我的域名，请填写自己的域名</span><br><span class="line">certbot-auto certonly -d *.lsgood.top -d lsgood.top</span><br></pre></td></tr></table></figure>
<p>修改nginx.conf：<br>server {<br>    listen 443 default ssl;<br>    server_name lsgood.top;<br>    ssl on;<br>    ssl_certificate xxxxxxxxx;#这个会被自动填写,是ssl 的公钥<br>    ssl_certificate_key xxxxx;#同上,是ssl 的私钥</p>
<pre><code>#其他不用设置可以
</code></pre><p>}</p>
<p>在设置 certbot 的时候需要注意碰到以下单词时，是需要到域名解析后台修改文件：</p>
<blockquote>
<p>Please deploy a DNS TXT record under the name _acme-challenge.lsgood.com with the following value:\<br>\<br>xxxxxxxxxxxxxxx\<br>\<br>Before continuing, verify the record is deployed.</p>
</blockquote>
<p>这意思是让你在继续下面之前，确保域名解析后台增加了以_acme-challenge 为前缀的子域名，同时将<code>xxxxxxxxxxxxxxx</code> 拷贝至里面的<strong>记录值</strong>一栏（记录类型为TXT）</p>
<p>参考:</p>
<p><a href="https://juejin.im/post/5b07c42c51882538c2203b2f#heading-2" target="_blank" rel="noopener">https://juejin.im/post/5b07c42c51882538c2203b2f#heading-2</a></p>
<p><a href="https://segmentfault.com/a/1190000017081357" target="_blank" rel="noopener">https://segmentfault.com/a/1190000017081357</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2019/01/21/2019-1-20lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/21/2019-1-20lesson/" class="post-title-link" itemprop="url">2019-1-20lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-21 07:23:42" itemprop="dateCreated datePublished" datetime="2019-01-21T07:23:42+00:00">2019-01-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-20 23:34:04" itemprop="dateModified" datetime="2019-01-20T23:34:04+00:00">2019-01-20</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="最近记录及经历"><a href="#最近记录及经历" class="headerlink" title="最近记录及经历"></a>最近记录及经历</h1><p>记录下最近忙的事情：</p>
<ol>
<li><p>面试后台</p>
</li>
<li><p>vps 重启导致没进入centos 系统，同时需要重启ssserver</p>
</li>
<li><p>公司组织活动</p>
</li>
</ol>
<h2 id="面试后台"><a href="#面试后台" class="headerlink" title="面试后台"></a>面试后台</h2><p>2019/1/17 晚上6:15 赶紧从锦江乐园开着那个破小电驴赶去仙霞路。终于在约定7点前3分钟到达亩的地。<br>进入后，笔试+机试。<br>笔试有</p>
<ul>
<li>module.epxorts 有什么特点</li>
<li>2个Node.js API 有什么区别</li>
<li>Node.js 使用什么库可以创建原生服务器，代码。</li>
<li>Node.js 子程序、子程序生成和沟通</li>
<li>js 什么是回调，如何防止回调地狱</li>
</ul>
<p>机试</p>
<p>express + pug + vue.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">index.jade</span><br><span class="line"></span><br><span class="line">template.</span><br><span class="line">    ...布局</span><br><span class="line">scripts.</span><br><span class="line">    ...scripts</span><br><span class="line"></span><br><span class="line">输入&quot;[&quot;a&quot;,&quot;1&quot;,&quot;2&quot;,&quot;1&quot;,&quot;b&quot;,&quot;3&quot;,&quot;4&quot;,&quot;a&quot;]&quot;</span><br></pre></td></tr></table></figure>
<p>将输入的文本传到后台，后台进行去重、排序得到<br>[“1”,”2”,”3”,”4”,”a”,”b”]<br>然后传递回前台展示</p>
<p>做这题的时候vue.js 基本都会，但是pug 的混合有点懵。<br>express 没有watch file 更新服务器的便利，我给加了supervisord 库。<br>给的电脑是linux系统，键盘啥的，却都是windows 的操作。好烦，一直用ctrl+s，这啥玩意。一直担心这次修改的代码是未同步的。<br>字又很小很小那种、没有鼠标使用触控板，那个垃圾触控板啊。<br>外面又很吵。</p>
<p>反正最后我只剩下“排序、去重”这俩 面试经理认为去网页找就好了的功能，我自己认为还算完成度高的（我还加了比如responseFormat、util、controller 分出操作）。<br>中间有个卡了点时间的地方：.jade template 里面想import 一个库，不行，最后找到ajax post 方法。</p>
<p>之后面试经理问了些工作经历、一些别的知识点等等。</p>
<p>做完面试，从晚上7点搞到了近晚上10点了都（确实时间长了点，不过跟环境有关吧，我自己环境搭起来，那就会特别特别爽，很快就能好，毕竟能断点嘛）。然后骑着已经一点电都没有的电驴推了好长一段路，幸好幸好没有下雨。推一会，骑一会，终于找到充电点，才终于回到家了。</p>
<p>第一次后台面试，感觉能胜任，没啥。<br>我现在还在做一个资源下载网页、真·聊天软件。这几天给他整好来，我觉得明年年初必定能很OK！！！</p>
<h2 id="vps重启、ssserver-启动"><a href="#vps重启、ssserver-启动" class="headerlink" title="vps重启、ssserver 启动"></a>vps重启、ssserver 启动</h2><p>首先我vps（搬瓦工CN2 专线）安装两次系统，导致重启之后，先点击左侧“terminal interaction”，然后会有新开一个网页版的操作交互页面，在提示“ESC”时， 需要按ESC 键进入选取系统页面，选取自己的server（我安装centos 6 x86），然后就可以进入centos 操作系统。</p>
<p>ssserver 我这里参考这篇<a href="https://github.com/Helinhan/-shadowsocks-serverspeeder-/issues/1" target="_blank" rel="noopener">git issue</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssserver -c /etc/shadowsocks.json -d start</span><br><span class="line">ssserver -c /etc/shadowsocks.json -d stop</span><br></pre></td></tr></table></figure>
<h2 id="新的公司“哇塞运动”公司组织活动"><a href="#新的公司“哇塞运动”公司组织活动" class="headerlink" title="新的公司“哇塞运动”公司组织活动"></a>新的公司“哇塞运动”公司组织活动</h2><p>时间：19.1.18 ~ 19.1.19<br>地点：苏州半岛阳澄湖酒店<br>事件：公司组织年会，团建</p>
<p>早上坐了一个半小时的大巴到达。休息半小时后，每个人先在一个大面板签字，留影。接着是茶话会，点评公司优秀员工，主管点评员工，回顾一年来事迹、点滴。</p>
<p>茶话会快结束了，还有剩余时间，我提议“成语接龙”，10s 没接上成语的同学发红包。玩了几圈，已经接近11点半，大家意犹未尽，但是还是抓紧休息时间，12点集合午饭时间。</p>
<p>中午饭简洁实在：吃饱。下午有活动，所以主要还是吃饱，晚上才是重头戏，不能和晚上抢了风头。有些同学还会有嫌弃说简陋，但是见其也吃的不多，这也是我疑惑的地方。人果然都是不同的，我是来则安，而总会有人嫌弃这嫌弃那，而自己却又服务得不多。</p>
<p>我做好自己的角色就好了，更不必理会不同的心声。</p>
<p>吃完饭，回酒店休息了下，那40分钟，终于把我的ssserver 重启回去了。提一点：酒店的网络估计国家有监管，百度搜索很多稍稍敏感东西都被屏蔽了，感觉不到gov 的意图，总觉得很多小丑想在我身边窥视我的一举一动。浑身不自在！</p>
<p>中午2点集合，集体出发去酒店附近的草地做运动。<br>首先大家分队，做些热身运动。<br>接着分成的两组开始接力跑。我们这组输了，原因有2：我们这组妹纸多一个；开头有个同学返回时没把接力棒传递，延迟数s之久。<br>开心即好。</p>
<p>接下来我们还是2队比拼过跳绳速度。这个在接下来体现在团队合作。比如<strong>黑洞</strong>同学加油，减少错误率，手感好的同学，多个一起进入，加速进程。我们这队先跳，有几个”黑洞”同学，但不敢置信的是二队的黑洞才是最厉害的！着实拖着队友，哈哈。</p>
<p>这两个游戏之后，还有三个游戏：报数抱团，毒圈丢球，撕名牌。</p>
<p>报数抱团：中间同学报数，然后其他队友围成圈，报数时其他同学报成对应数字。<br>我怎么输的，在第三波时，数字8，我站过去是9，只能牺牲小我牺牲啦。</p>
<p>毒圈丢球：全员分成四个队，中间一个队伍，其他三个队使用软球，将中间队伍砸下。</p>
<p>撕名牌：大家身穿小外衣，两队颜色。背后由正反胶贴着自己的铭牌。大家分成两队，根据时间，慢慢缩小毒圈。大家互相开撕。</p>
<p>这里说几个有意思的：撕的铭牌，那个黏度，三个男的扯都扯不下来。我当时被三个人撕都撕不下，哈哈，活到了最后。我觉得人事部一个小姑凉撕的人可就多，好多人被她撕撕撕。我一直躲躲躲，躲到了比赛最后，胜利✌️。<br>这游戏包括了好几波，都快喘不过气了。玩的没心没肺啊，如同回到大学时期。公司强项不愧是做策划执行的，线下的执行简直没话说的。</p>
<p>大家玩完之后回酒店休息了下。没一会去吃晚饭。</p>
<p>晚饭吃的就稍微更好了。这次喝的酒也稍微多了一些，米西米西。好吃的有一个小虾米，很嫩很滑口；苏州必带鸡汤么；烤猪脚很香；期间蒋总、翟总述说自己往事，公司建立来由，张总10年没放弃。2005年创建“点傲”，2014启动哇塞，合并为“冠脉堂”。期间张希亮，张总喝多了，说点傲团队，人员坚持下去，十年后还是大家伙，张总自己掏钱给留着的伙伴5w报答。确实，这就是新兴的互联网不能比的。互联网人，自身难保，随时可能被开，还想着自己留在公司？？（耳边有些小伙伴传来问是冠脉堂全员吗？小声嘀咕问。有这想法的人，看来年龄尚浅，未来前路只能在他人鼻息下留存啊）</p>
<p>吃完之后回到酒店休息了下，就已经要晚上的晚会表演了。我们技术部本来要彩排一下的，已经来不及，直接开始了。</p>
<p>我在这也有个小项目，就是唱<strong>革命人永远年轻</strong>这首歌。这首红歌，是大学红歌比赛时，我作为领唱，身后都是老师、院长、同学们，台下是几千人的同学，当时的我激动、紧张，使得我不经意间，不自觉、无法控制的腿抖。这次我要打破自己，表达自己。</p>
<p>其实我在粉粉的时候就有多次code review、技术分享，在实践，表达，突破。这次很成功的表演（会不会是人比较少的原因，再也没有腿抖，也没有丝许不安？应该不是吧，哈哈）。</p>
<p>翟总为我们深情朗诵，蒋总给我带来一曲古典的<strong>梨花颂</strong>。这首歌我高二的时候特别喜欢，喜欢不得了，现在老了，在工作场景耕耘，眼前早已不是夜景烟花，桃色满目了。<br>我们技术部有俩节目。有一个”兔子舞”，得了，崩盘。之后我们大合唱<strong>明天会更好</strong>,只能凭借真诚，最好还好，收了场。<br>边表演节目，边抽奖，反正我是没能拿到什么奖，阳光普照吧。<br>我觉得一等奖倒是挺意外，而且老板们脸都要绿的那种。平时最不干活，干活老喊累，推诿，能力最差的前端同学得到了，哈哈，我觉得老板脸，不是很好看，哈哈。</p>
<p>接下来大家吃东西，唱歌，那玩个游戏。有个人带上眼罩，转三圈，然后在场地抓人，抓到人之后要猜出试谁。这个游戏也挺好玩的，我一直没被抓到过，之后一次请缨，有意思。这期间有个哥们为了猜出另一个哥们是谁，上上下下摸了个遍，都快亲上去了。哈哈</p>
<p>基本这天就这么过去了，第二天回上海，然后那天下午，我们还加了半天班，想猴头菇了。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2019/01/05/2019-1-5lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/05/2019-1-5lesson/" class="post-title-link" itemprop="url">2019-1-5lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-05 21:12:41" itemprop="dateCreated datePublished" datetime="2019-01-05T21:12:41+00:00">2019-01-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-10 00:16:54" itemprop="dateModified" datetime="2019-01-10T00:16:54+00:00">2019-01-10</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Dockerfile-install-very-slow"><a href="#Dockerfile-install-very-slow" class="headerlink" title="Dockerfile install very slow"></a>Dockerfile install very slow</h1><p>According to <a href="https://christianfei.com/posts/Cache-speed-up-docker-node-modules/" target="_blank" rel="noopener">this artical</a>, I resolve an issue that i have to load all <strong>node_module</strong> files very time;</p>
<p>This method help with: building the same package.json and and same file path, would never ever to load every file again, but first would still very slow.</p>
<p>do step:</p>
<p>first add your <strong>.dockerignore</strong> with:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.git</span><br><span class="line">.results</span><br><span class="line">script</span><br><span class="line">*Dockerfile*</span><br><span class="line">node_modules</span><br><span class="line">package-lock.json</span><br></pre></td></tr></table></figure>
<p>then:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">8.12</span>.<span class="number">0</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> NODE_ENV=development</span><br><span class="line"><span class="keyword">ENV</span> NODE_ENV=$NODE_ENV</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span> /watchvideo_server</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span> package.json yarn.lock ./</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span> . /watchvideo_server</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span> yarn</span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> node</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">9526</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span> ["yarn", "start"]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line">services:</span><br><span class="line">  mysql:</span><br><span class="line">    build: ./mysql</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;4444:3306&quot;</span><br><span class="line">  watch:</span><br><span class="line">    build: .</span><br><span class="line">    hostname: watch</span><br><span class="line">    command: yarn debug</span><br><span class="line">    volumes:</span><br><span class="line">      - ./dist:/watchvideo_server/dist</span><br><span class="line">      - ./package.json:/watchvideo_server/package.json</span><br><span class="line">      - ./yarn.lock:/watchvideo_server/yarn.lock</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9526:9526&quot;</span><br><span class="line">      - &quot;9222:9222&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysql</span><br><span class="line">    links:</span><br><span class="line">      - mysql</span><br><span class="line">    environment:</span><br><span class="line">      - DATABASE_HOST=mysql</span><br></pre></td></tr></table></figure>
<h2 id="I’m-making-a-media-site"><a href="#I’m-making-a-media-site" class="headerlink" title="I’m making a media site"></a>I’m making a media site</h2><p>When 2018.6, I decided to make some games to try earning some money and advertise.</p>
<p>But gov said NO: gov suddenly gave a notify, field of game would become more difficult.</p>
<p>OK, when 2018.12, I change my mind to make a media site to provide some picture sources and ability of watching video.</p>
<p>But gov immediatly gave notify: master of <strong>BT video site</strong> was caughted and get 3 year of prison with 80w RMB ticket.</p>
<p>Ability of IT worker is very difficultlly control by zh gov, so they afraid of any man is out of control.</p>
<p>If you feel comfortable with that ease, you will done soon or later.</p>
<p>I’m would never be.</p>
<h1 id="Man-become-poverty"><a href="#Man-become-poverty" class="headerlink" title="Man become poverty"></a>Man become poverty</h1><p>Man dare to chanllenge for fight, but during recent couple of year, harsh enviroument is expressing more tough to not getting close to the civilization and ability.</p>
<p>Man died by kind of poverty.</p>
<p>Poverty caused by not treating them as power, but treating tasty word as governance model.</p>
<p>So Man deserve poverty by not taking seriously of bazoo?</p>
<p>fucking bazooer!!!</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2019/01/01/2018-12-31lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/01/2018-12-31lesson/" class="post-title-link" itemprop="url">2018-12-31lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-01 07:39:20" itemprop="dateCreated datePublished" datetime="2019-01-01T07:39:20+00:00">2019-01-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-09 21:12:00" itemprop="dateModified" datetime="2019-01-09T21:12:00+00:00">2019-01-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>一年的最后一天,补一个日记。<br>希望明年真正做到盈利。<br>汪汪汪</p>
</blockquote>
<h1 id="New-VPS-Centos6-config"><a href="#New-VPS-Centos6-config" class="headerlink" title="New VPS Centos6 config"></a>New VPS Centos6 config</h1><p>//查看系统位数<br>file /bin/ls<br>getconf LONG_BIT<br>uname -a || uname -r</p>
<p>service docker start/stop (当前为1.7.1)<br><a href="https://stackoverflow.com/questions/35385853/yum-install-error-docker" target="_blank" rel="noopener">https://stackoverflow.com/questions/35385853/yum-install-error-docker</a><br>yum install <a href="http://yum.dockerproject.org/repo/main/centos/6/Packages/docker-engine-1.7.1-1.el6.x86_64.rpm" target="_blank" rel="noopener">http://yum.dockerproject.org/repo/main/centos/6/Packages/docker-engine-1.7.1-1.el6.x86_64.rpm</a><br>这个包才是存在的</p>
<p>yum install -y wget</p>
<p>centos 6 安装Nginx<br><a href="https://www.cyberciti.biz/faq/install-nginx-centos-rhel-6-server-rpm-using-yum-command/" target="_blank" rel="noopener">https://www.cyberciti.biz/faq/install-nginx-centos-rhel-6-server-rpm-using-yum-command/</a> </p>
<p>之上一直因为centos6 的epel-release 这个扩展源 老是装不进，所以在安装一堆东西时，总是显示“nothing to do”。<br>我一直以为EPEL 是装进去的，而且是最新的，然而并没有安装进去。<br><a href="https://unix.stackexchange.com/questions/153566/installing-epel-repository-on-centos-fails" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/153566/installing-epel-repository-on-centos-fails</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -ev epel-release-6-8.noarch</span><br><span class="line">yum update</span><br><span class="line">rpm -ivh http://dl.fedoraproject.org/pub/epel/6/$(uname -i)/epel-release-6-8.noarch.rpm</span><br></pre></td></tr></table></figure></p>
<p>安装入这个后，yum 源就有python-pip 了</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shaohung001.github.io/2018/12/24/2018-12-24lesson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aKer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aKer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/24/2018-12-24lesson/" class="post-title-link" itemprop="url">2018-12-24lesson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-24 20:59:02" itemprop="dateCreated datePublished" datetime="2018-12-24T20:59:02+00:00">2018-12-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-09 21:13:02" itemprop="dateModified" datetime="2019-01-09T21:13:02+00:00">2019-01-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="购买了一个服务器，折腾了一天给相关环境整理了下。"><a href="#购买了一个服务器，折腾了一天给相关环境整理了下。" class="headerlink" title="购买了一个服务器，折腾了一天给相关环境整理了下。"></a>购买了一个服务器，折腾了一天给相关环境整理了下。</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OS: centos 6 x86_64 # docker 一定要64位</span><br><span class="line">服务器采用docker + koa + mongodb</span><br><span class="line">前端采用Next.js + mobx + antd 组合</span><br></pre></td></tr></table></figure>
<h1 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h1><p>由于docker 在centos6 下只能采用1.7.1 版本，导致docker-compose 只能采用1.5.2 版本。</p>
<p>环境要求：python2.7.12;.yml file version为1</p>
<p><a href="CentOS6.x 安装 Docker 和 Docker Compose">参考博文</a></p>
<p>服务器Dockerfile:</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">8.12</span>.<span class="number">0</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span> /server</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span> . /server</span><br><span class="line"><span class="keyword">RUN</span> npm install</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">9527</span></span><br><span class="line"><span class="keyword">CMD</span> ["yarn", "start"]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mongo:</span><br><span class="line">  image: &quot;mongo:3.6.9-stretch&quot;</span><br><span class="line">  volumes:</span><br><span class="line">    - ./data:/data/db</span><br><span class="line">  ports:</span><br><span class="line">    - &quot;27017:27017&quot;</span><br><span class="line">web:</span><br><span class="line">  build: .</span><br><span class="line">  command: npm start</span><br><span class="line">  volumes:</span><br><span class="line">    - ./dist:/server/dist</span><br><span class="line">  ports:</span><br><span class="line">    - &quot;9527:9527&quot; #我就想用这个端口</span><br><span class="line">  links:</span><br><span class="line">    - mongo</span><br></pre></td></tr></table></figure>
<p>package.json/script:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "watch": "tsc -w -p ./src",</span><br><span class="line">    "debug": "nodemon --watch ./dist --inspect=0.0.0.0:9222 --nolazy ./dist/www.js",</span><br><span class="line">    "docker-debug": "docker-compose up",</span><br><span class="line">    "start": "node ./dist/www.js",</span><br><span class="line">    "mocha-test": "mocha -t 8000 --recursive "</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>运行docker 出现<code>iptables failed - No chain/target/match by that name</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t filter -N DOCKER</span><br><span class="line">service docker restart</span><br></pre></td></tr></table></figure>
<ul>
<li>mongodb 总是连不上</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. docker-compose.yml 的links 不能缺少</span><br><span class="line">2. mongoose.connect(db_url) 的db_url 确认是docker-compose 的image 名。如我的&quot;mongo&quot;</span><br><span class="line">3. 失败重连</span><br><span class="line">const connectWithRetry = () =&gt; &#123;</span><br><span class="line">    console.log(&quot;MongoDB connection with retry&quot;);</span><br><span class="line">    mongoose.connect(db_url, options).then(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;MongoDB is connected&quot;);</span><br><span class="line">    &#125;).catch(err =&gt; &#123;</span><br><span class="line">        console.log(&quot;MongoDB connection unsuccessful, retry after 5 seconds.&quot;);</span><br><span class="line">        setTimeout(() =&gt; connectWithRetry(), 5000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">connectWithRetry();</span><br></pre></td></tr></table></figure>
<ul>
<li>服务器在vscode debug</li>
</ul>
<p>参考vscode 原文<a href="https://github.com/Microsoft/vscode-recipes/tree/master/Docker-TypeScript" target="_blank" rel="noopener">我是原文</a></p>
<h1 id="Nextjs-配置"><a href="#Nextjs-配置" class="headerlink" title="Nextjs 配置"></a>Nextjs 配置</h1><p>接下来是nextjs 推送记录</p>
<ol>
<li>nextjs 编译环境有要求：RAM 1G</li>
</ol>
<p>我服务器就1G，不然编译的时候会报”code 137”,提示内存不足，同时导致服务器mongodb 一直弹提示<code>centos mongodb [ftdc] serverStatus was very slow: { after basic: 163, after asserts:</code>。</p>
<p>解决办法是采用开发机器<code>yarn build</code> 后，将<strong>.next</strong> 文件夹git commit ，然后同步过来。</p>
<ol start="2">
<li>nextjs 使用pm2 start:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#https://github.com/zeit/next.js/issues/109</span><br><span class="line"># for development</span><br><span class="line">pm2 start npm --name &quot;next&quot; -- run dev</span><br><span class="line"></span><br><span class="line"># for production</span><br><span class="line">npm run build</span><br><span class="line">pm2 start npm --name &quot;next&quot; -- start</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>nextjs 需要在域名根目录运行， 否则出现static 静态路由找不到。其他route 也会找不到的情况。</li>
</ol>
<p>nginx 配置如:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">server_name</span> www.lsgood.top lsgood.top;</span><br><span class="line">    <span class="attribute">root</span> /var/www;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    <span class="attribute">location</span> ~^/facicon\.ico$ &#123;</span><br><span class="line">        <span class="attribute">root</span> /var/www;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:9005;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">'upgrade'</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /japeneeza/ &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:9527/;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>nextjs 没有storage；同时 server side 获取不到cookie</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yarn add js-cookie cookieParser</span><br><span class="line"></span><br><span class="line">cookie <span class="keyword">set</span> <span class="keyword">get</span> cookie (自行参考cookie 保存token)</span><br><span class="line">eg: jsCookie.<span class="keyword">set</span>("token", $&#123;token&#125;)</span><br><span class="line"></span><br><span class="line">server.js(express)</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">"cookieParser"</span>)</span><br><span class="line">server.use(cookieParser())</span><br><span class="line"></span><br><span class="line">然后在pages 里的pageClass.getInitialProps = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">&#123;ctx&#125;</span>) =&gt; </span>&#123;</span><br><span class="line">    cosnt &#123; req &#125; = ctx;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"token:"</span>, req.cookies.token)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="让你知道技术的力量"><a href="#让你知道技术的力量" class="headerlink" title="让你知道技术的力量"></a>让你知道技术的力量</h1><p>A: 什么？不相信我的能力？<br>A(咆哮): 我要让你们知道 the ability of super technology!!!</p>
<p>门外, 砰砰砰: 开门，查水表.</p>
<p>A: 大家快点收拾东西，藏起来，丢到窗外，快点快点。。。</p>
<p><a href="本来想做一个视频网站，想想还要各种“证”，到时先做小的视频网站，，然后转成会员卖套图吧。国内什么都做不了，什么都不能做，国家要各种屁民听话。我觉得公务员们不认为自己是中国人，他们认为自己是体制人，是平民的上司。他们凭什么呀？都是我们纳税人养着的服务人员，怎么就有这么多的特权？纳税的意义在哪里？好好活着吧。"></a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">aKer</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">116</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aKer</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>



  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
