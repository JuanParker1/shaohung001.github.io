<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    
    
    <title>2019-6-10lesson | aKer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content>
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/css/style.css?v=1.4.4">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class>
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">aKer</h5>
          <a href="mailto:767838865@qq.com" title="767838865@qq.com" class="mail">
            
              <span>7</span>
            
              <span>6</span>
            
              <span>7</span>
            
              <span>8</span>
            
              <span>3</span>
            
              <span>8</span>
            
              <span>8</span>
            
              <span>6</span>
            
              <span>5</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/shaohung001" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class>
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class>
              <a href="/categories">
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class>
              <a href="/tags">
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class>
              <a href="/archives">
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
            <li class>
              <a href="/custom">
                <i class="icon icon-lg icon-plus-square"></i>
                CUSTOM
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2019-6-10lesson</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">2019-6-10lesson</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-09-13T15:26:02.000Z" itemprop="datePublished" class="page-time">
  2019-09-13
</time>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left">
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-2019-6-10lesson" class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2019-6-10lesson</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-09-13 23:26:02" datetime="2019-09-13T15:26:02.000Z" itemprop="datePublished">2019-09-13</time>

            


            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h1 id="docker-mongo-dump-restore"><a href="#docker-mongo-dump-restore" class="headerlink" title="docker mongo dump restore"></a>docker mongo dump restore</h1><h2 id="Dump"><a href="#Dump" class="headerlink" title="Dump"></a>Dump</h2><pre><code>docker run --name newMongo -p 27018:27017 --rm mongo
</code></pre><p>另开一个terminal</p>
<pre><code>docker exec -it newMongo /bin/bash

mongodump -h 127.0.0.1 --port 27017 -d ${your db} -o /test/mongodBack

exit # 退出docker mongo容器

docker cp newMongo:/test/mongodBack/ /mongodBack/ # 将docker 内文件拷到/mongodBack/
</code></pre><h2 id="Restore"><a href="#Restore" class="headerlink" title="Restore"></a><strong>Restore</strong></h2><p>待撸待撸</p>
<p>参考：<a href="https://www.cnblogs.com/qiyc/p/10150433.html" target="_blank" rel="noopener">https://www.cnblogs.com/qiyc/p/10150433.html</a></p>
<h1 id="OAuth2-server-撸saas-微应用化"><a href="#OAuth2-server-撸saas-微应用化" class="headerlink" title="OAuth2-server 撸saas 微应用化"></a><strong>OAuth2-server 撸saas 微应用化</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Client frontend] GET /auth/honglian to [Client backend]</span><br><span class="line">[Client backdnd] redirectTo [Server frontend] page : /oauth/authorize?clientId=x&amp;redirectUri=x&amp;response_code=code</span><br><span class="line">[Server frontend] POST /oauth/login/authorise to [Server backend] to fetch oauth authorization_code</span><br><span class="line">[Server frontend] redirectTo(window.location) redirectUri + code=$&#123;authorization_code&#125;</span><br><span class="line">[Client backend] get authorization_code</span><br><span class="line">[Client backend] POST /oauth/access_token/?client_id=x -H &apos;authorization=$&#123;authorization_code&#125;&apos; to [Server backend] to fetch access_token</span><br><span class="line">[Server backend] return access_token to [Client backend]</span><br><span class="line">[Client backend] GET /api/user/?client_id=x&amp;client_secret=x&amp;access_token to [Server backend]</span><br><span class="line">[Server backend] return userProfile to [Client backend]</span><br><span class="line">[Client backend] redirectTo [/user/home]</span><br></pre></td></tr></table></figure>
<p>beyond over!</p>
<p>参考：</p>
<ol>
<li><p><a href="https://gist.github.com/tabone/d74fb922669e4edc22bfd0833b5ae88b" target="_blank" rel="noopener">https://gist.github.com/tabone/d74fb922669e4edc22bfd0833b5ae88b</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/vipzhou/p/8125924.html" target="_blank" rel="noopener">https://www.cnblogs.com/vipzhou/p/8125924.html</a></p>
</li>
</ol>
<h1 id="www-form-urlencoded-d-里面的-空格-被替换成-的问题"><a href="#www-form-urlencoded-d-里面的-空格-被替换成-的问题" class="headerlink" title="www-form-urlencoded -d 里面的 空格 被替换成+的问题"></a><strong>www-form-urlencoded -d 里面的 <code>空格</code> 被替换成<code>+</code>的问题</strong></h1><p>场景是用户发送一个<code>www-form-urlencoded</code> 内容是一个机器码，比如<code>MH20ew2r9RuTyGcX+rrmxF7X40U=</code> 但是发现传到服务器时，却变成了<code>MH20ew2r9RuTyGcX rrmxF7X40U=</code>. 中间是空格代替。</p>
<p>原因是空格在urlencoded 中就是”+”。于是参数从软件客户端发到web 时都是正确的。但是到了body-parser 时，body-parser 看到一个 <strong>+</strong>，想都不想，直接就转成空格了。、</p>
<p>临时处理办法：将该文本转回去: string.replace(/\s/g, ‘+’)</p>
<p>最终解决方案：软件客户端使用urlencoded 刷新string</p>
<h1 id="Chrome-Extension-使用Vue-遇到的一些问题"><a href="#Chrome-Extension-使用Vue-遇到的一些问题" class="headerlink" title="Chrome Extension 使用Vue 遇到的一些问题"></a><strong>Chrome Extension 使用Vue 遇到的一些问题</strong></h1><p>Vue 使用webpack。但是background.js 属于后台，使用nodejs，于是webpack 找require 函数时可能会找不到比如<strong>fs</strong> 的库：Module not found.</p>
<p>做的第一种尝试: 在webpack 打包target 默认为的<code>web</code> 替换为<code>node</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    target: &apos;web&apos;,</span><br><span class="line">    node: &#123;</span><br><span class="line">        console:false,</span><br><span class="line">        global: true,</span><br><span class="line">        process: true,</span><br><span class="line">        fs: true,</span><br><span class="line">        __filename: &apos;mock&apos;,</span><br><span class="line">        ___dirname: &quot;mock&quot;,</span><br><span class="line">        Buffer: true,</span><br><span class="line">        setImmediate: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这样的也导致输出的是node 环境。界面上的css 样式全部都不识别了。<br>于是替换一种思路。</p>
<p>第二种尝试: 前段还是按照前段，后端之所以称之为后端，那么便是另外一个项目了。webpack 打包时，打一个虚拟的，没有任务的background 包。于是<code>yarn watch</code> 阶段background 包打进去之后，手动替换里面background.js。</p>
<p>终于，里面运行的非常正常了。</p>
<p>这种方法不同点是，之前的background 配置是page,现在应为scripts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">background: &#123;</span><br><span class="line">    page: &quot;./background.html&quot;</span><br><span class="line">    scripts: [&quot;./background.js&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="https://cloud.tencent.com/developer/section/1477428" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1477428</a></li>
<li><a href="https://cloud.tencent.com/developer/section/1477500" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1477500</a></li>
</ul>
<h2 id="Typescript-mocha-chai-单元测试"><a href="#Typescript-mocha-chai-单元测试" class="headerlink" title="Typescript + mocha + chai 单元测试"></a><strong>Typescript + mocha + chai 单元测试</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yarn add mocha @types/mocha chai @types/chai chai-http @types/chai-http -D</span><br><span class="line"></span><br><span class="line">package.json</span><br><span class="line">    scripts</span><br><span class="line">        test: NODE_ENV=test mocha -t 5000 --require ts-node/register test/**/*.ts</span><br><span class="line"></span><br><span class="line">/test</span><br><span class="line">    diary.spec.ts</span><br></pre></td></tr></table></figure>
<p>diary.spec.ts:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; app &#125; <span class="keyword">from</span> <span class="string">'../src/app'</span></span><br><span class="line"><span class="keyword">import</span> chai, &#123; expect &#125; <span class="keyword">from</span> <span class="string">'chai'</span></span><br><span class="line"><span class="keyword">import</span> chaiHttp <span class="keyword">from</span> <span class="string">'chai-http'</span></span><br><span class="line">chai.use(chaiHttp)</span><br><span class="line"><span class="keyword">import</span> <span class="string">'mocha'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userLoginCookie = <span class="string">'123456'</span> <span class="comment">// 由于使用OAuth 服务，那块代码就没有测，直接使用Cookie</span></span><br><span class="line">describe(<span class="string">'测试diary 接口'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'等待数据库载入完毕'</span>)</span><br><span class="line">            done()</span><br><span class="line">        &#125;, <span class="number">1000</span>) <span class="comment">// 时间可以加长，这里链接了mlab ，比较慢，可以为4000(有时仍然会出错)</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'Test getBudgetList'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">        chai.request(app)</span><br><span class="line">            .post(<span class="string">'/api/diary/getBudgetList'</span>)</span><br><span class="line">            .set(<span class="string">'Cookie'</span>, userLoginCookie)</span><br><span class="line">            .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.status === <span class="number">403</span>) &#123;</span><br><span class="line">                    done(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'403 用户需要先登录'</span>))</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> arr = res.body <span class="keyword">as</span> <span class="built_in">any</span>[]</span><br><span class="line">                    expect(arr.length).to.equal(<span class="number">0</span>)</span><br><span class="line">                    done()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="fs-read-readFile-在读取中文时乱码"><a href="#fs-read-readFile-在读取中文时乱码" class="headerlink" title="fs.read/readFile 在读取中文时乱码"></a><strong>fs.read/readFile 在读取中文时乱码</strong></h2><p>需求：文件使用Buffer 读出, 然后一个一个解析里面的中英文<br>环境：文件很大, 所以没办法直接读出、直接写出</p>
<p><em>注意：这个需求不是编码的问题。比如GBK。GBK使用iconv_lite 解决</em></p>
<p>英文占一个字节，中文三个字节，所以一个个读出的buffer， 中文时便出现该字找不到，所以nodejs 使用<buffer ef df db> 进行替换。</buffer></p>
<p>nodejs 那些常见的读写库其实都导入了<code>string_decoder</code> 的库</p>
<p>使用是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; StringDecoder &#125; <span class="keyword">from</span> <span class="string">'string_decoder'</span></span><br><span class="line"><span class="keyword">const</span> decoder = <span class="keyword">new</span> StringDecoder(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> next = decoder.write(readBuffer)</span><br><span class="line">  <span class="keyword">if</span> (next.length) &#123;</span><br><span class="line">    <span class="comment">// 这就是得到的buffer</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>decoder 原理是解析出来的，如果是中文三字节找不到，那么就储存起来，等到合并成一个。</p>
<p>附上 oneByOne 读写每个文本</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; StringDecoder &#125; <span class="keyword">from</span> <span class="string">"string_decoder"</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">'fs'</span></span><br><span class="line"><span class="keyword">import</span> &#123; call &#125; <span class="keyword">from</span> <span class="string">'./awaitCall'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> one_openFile = <span class="keyword">async</span> (absolutePath: <span class="built_in">string</span>, mode=<span class="string">'r'</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [e, fd] = <span class="keyword">await</span> call(fs.open ,absolutePath, mode, <span class="number">0o666</span>)</span><br><span class="line">  <span class="keyword">if</span> (e) <span class="keyword">throw</span> e</span><br><span class="line">  <span class="keyword">return</span> fd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> one_readFile = <span class="keyword">async</span> (fd: <span class="built_in">number</span>, offset=<span class="number">0</span>, cb?: <span class="built_in">Function</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> oneByOneSize = <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> len = oneByOneSize</span><br><span class="line">  <span class="keyword">let</span> readIndex = <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> decoder = <span class="keyword">new</span> StringDecoder(<span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> readBuffer = Buffer.alloc(oneByOneSize)</span><br><span class="line">    <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> call(fs.read, fd, readBuffer, offset, len, readIndex)</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">    <span class="keyword">if</span> (!res.bytesRead) &#123;</span><br><span class="line">      <span class="comment">// 文件读完了</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"文件读写完毕"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> next = decoder.write(readBuffer)</span><br><span class="line">    <span class="keyword">if</span> (next.length) &#123;</span><br><span class="line">      <span class="keyword">if</span> (cb)</span><br><span class="line">        cb(next)</span><br><span class="line">    &#125;</span><br><span class="line">    readIndex ++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Run-Mocha-programmatically"><a href="#Run-Mocha-programmatically" class="headerlink" title="Run Mocha programmatically"></a><strong>Run Mocha programmatically</strong></h2><p>在代码中执行mocha。在实际环境中进行单元测试。</p>
<p><a href="https://github.com/mochajs/mocha/wiki/Using-mocha-programmatically" target="_blank" rel="noopener">mocha 官网示例</a></p>
<p><a href="https://stackoverflow.com/questions/29050720/run-mocha-programmatically-and-pass-results-to-variable-or-function" target="_blank" rel="noopener">stackoverflow</a></p>
<h2 id="express-limiter"><a href="#express-limiter" class="headerlink" title="express-limiter"></a><strong>express-limiter</strong></h2><p>遇到情况：有一个注册、即立即登录，快速注册快速登录的接口，这里express-limiter 可以多次请求</p>
<p>去redis 上看了下，key 每次都不同</p>
<p>去express-limiter 里看了下, 他的redis key 来自line17: var key = opts.keyFormatter(opts.lookup(req))</p>
<h2 id="Nginx-默认上传文件大小-1M"><a href="#Nginx-默认上传文件大小-1M" class="headerlink" title="Nginx 默认上传文件大小:1M"></a><strong>Nginx 默认上传文件大小:1M</strong></h2><p>server {<br>  listen 80;<br>  server_name xxx;<br>  client_max_body_size 100M;<br>}</p>
<h2 id="vue-electron-使用electron-builder-不能打包win"><a href="#vue-electron-使用electron-builder-不能打包win" class="headerlink" title="vue-electron 使用electron-builder 不能打包win"></a><strong>vue-electron 使用electron-builder 不能打包win</strong></h2><p>issue:<a href="https://github.com/SimulatedGREG/electron-vue/issues/487" target="_blank" rel="noopener">https://github.com/SimulatedGREG/electron-vue/issues/487</a></p>
<p>yarn build:win : “node .electron-vue/build.js &amp;&amp; electron-builder -w”</p>
<h2 id="TS-获取自身Class"><a href="#TS-获取自身Class" class="headerlink" title="TS 获取自身Class"></a>TS 获取自身Class</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> MyClass &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = <span class="keyword">new</span> MyClass();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(instance.constructor.name); <span class="comment">// MyClass</span></span><br><span class="line"><span class="built_in">console</span>.log(MyClass.name);              <span class="comment">// MyClass</span></span><br></pre></td></tr></table></figure>
<p><code>instance.constructor</code> 就是得到的class 转义后的Class 对象。</p>
<h4 id="Nginx-设置同源策略"><a href="#Nginx-设置同源策略" class="headerlink" title="Nginx 设置同源策略"></a>Nginx 设置同源策略</h4><p>这里还是使用上面文章说明：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Origin *;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Headers X-Requested-With;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Methods GET,POST,OPTIONS;</span><br></pre></td></tr></table></figure>
<p>然后使用自己的域名。</p>
<p>以上完成了本次要搭建直播、理解推流、拉流的动作过程。</p>
<h3 id="人生苦短，我们用go"><a href="#人生苦短，我们用go" class="headerlink" title="人生苦短，我们用go"></a>人生苦短，我们用go</h3><p>有句话挺有意思的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nodejs 可玩性还是蛮高的，可以C艹binding。</span><br><span class="line">但是又多学一个，为什么不用golang?</span><br></pre></td></tr></table></figure>
        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-06-04T04:16:35.987Z" itemprop="dateUpdated">2020-06-04 12:16:35</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2019/09/13/2019-6-10lesson/" target="_blank" rel="external">https://shaohung001.github.io/2019/09/13/2019-6-10lesson/</a>
        
    </div>
    <footer>
        <a href="https://shaohung001.github.io">
            <img src="/img/avatar.jpg" alt="aKer">
            aKer
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://shaohung001.github.io/2019/09/13/2019-6-10lesson/&title=《2019-6-10lesson》 — aKer&pic=https://shaohung001.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://shaohung001.github.io/2019/09/13/2019-6-10lesson/&title=《2019-6-10lesson》 — aKer&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/12/26/2019-12-26lesson/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">2019-12-26lesson.md</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/09/06/2019-9-6lesson/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">2019-9-6lesson</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#docker-mongo-dump-restore"><span class="post-toc-number">1.</span> <span class="post-toc-text">docker mongo dump restore</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Dump"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Dump</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Restore"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Restore</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#OAuth2-server-撸saas-微应用化"><span class="post-toc-number">2.</span> <span class="post-toc-text">OAuth2-server 撸saas 微应用化</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#www-form-urlencoded-d-里面的-空格-被替换成-的问题"><span class="post-toc-number">3.</span> <span class="post-toc-text">www-form-urlencoded -d 里面的 空格 被替换成+的问题</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Chrome-Extension-使用Vue-遇到的一些问题"><span class="post-toc-number">4.</span> <span class="post-toc-text">Chrome Extension 使用Vue 遇到的一些问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Typescript-mocha-chai-单元测试"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">Typescript + mocha + chai 单元测试</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#fs-read-readFile-在读取中文时乱码"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">fs.read/readFile 在读取中文时乱码</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Run-Mocha-programmatically"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">Run Mocha programmatically</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#express-limiter"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">express-limiter</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nginx-默认上传文件大小-1M"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">Nginx 默认上传文件大小:1M</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#vue-electron-使用electron-builder-不能打包win"><span class="post-toc-number">4.6.</span> <span class="post-toc-text">vue-electron 使用electron-builder 不能打包win</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TS-获取自身Class"><span class="post-toc-number">4.7.</span> <span class="post-toc-text">TS 获取自身Class</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Nginx-设置同源策略"><span class="post-toc-number">4.7.0.1.</span> <span class="post-toc-text">Nginx 设置同源策略</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#人生苦短，我们用go"><span class="post-toc-number">4.7.1.</span> <span class="post-toc-text">人生苦短，我们用go</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </div></div></aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        我们一起来让这个世界有趣一点
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/css/images/wechatPay.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/css/images/wechatPay.jpg" data-alipay="/css/images/aliPay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    

</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://github.com/shaohung001" target="_blank">HOME</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                aKer &copy; 2017 - 2022
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://shaohung001.github.io/2019/09/13/2019-6-10lesson/&title=《2019-6-10lesson》 — aKer&pic=https://shaohung001.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://shaohung001.github.io/2019/09/13/2019-6-10lesson/&title=《2019-6-10lesson》 — aKer&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKElEQVR42u3aQXLjMAwEQP//05sP2JsZIEpFVPuUSskm24cxAfD1il//1q9Pn/lpldcVLwwMjNsykuWTzSWbSN6VrPtmFQwMjAcw/r9k+8ynrSS8dl0MDAyMfIt5ZLf/wcDAwJgFbltqtqUsBgYGxqyI3fS+km3lxTMGBsbTGG1c/ubfl8w3MDAwbsXYjCHzI107zqx3hYGBcTQjD7jrDnmzwMXAwHgaYx+jeYAmX82+tYeBgXEeI3/bvhmXkPJQ/uZ3AwMD4whGUmomm96Ur21Mv3keAwPjaMasBG2L0pyXt/miIhYDA+MIxixw22FkcbWrvLox/IYwMDBuzpiVtW3p244Z6hMuBgbGQYzNRmeBm4wHVmMJDAyM4xj5patNu23Diw6IGBgYRzP2ly3aY2L7mb90ZwQDA+MPM64YMc5CNh8JREdDDAyMgxhtIOYp3g47218GDAyMpzHy2E2uR7SXM5ISeliRY2BgHMfYHP7aI2ZeNg8nGxgYGIcy8gKybd/nAZ1/wpvVMTAwHsNor3PNxgn1vCKJZgwMjAcwkmDdHBPz8B32CzEwMA5lzJpfLWY/zvxmIIGBgXE0YzYyzMeQs3hNStbhERMDA+O2jE3Iztpq+aA0b/NhYGA8gTELvp8aRs6K2I/tNgwMDIxRQ20GLopYDAwMjPUz7aA0Ia0CFwMD44aM2QAyb/rX17yua7dhYGDckNFeyUre/LOXLdpyGgMD4yDGF5b1slDf7iZ+AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.4.4"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/blog.js?v=1.4.4"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.4.4"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>







    
</body>
</html>
